// All functions that need access to the editor's state live inside
// the CodeMirror function. Below that, at the bottom of the file,
// some utilities are defined.
// CodeMirror is the only global var we claim
window.CodeMirror=function(){"use strict";function e(r,i){function fn(e){if(s.onDragEvent&&s.onDragEvent(pn,V(e)))return;K(e)}function hn(e){return e>=0&&e<_t.size}function dn(e){return q(_t,e)}function vn(e,t){Jt=!0;var n=t-e.height;for(var r=e;r;r=r.parent)r.height+=n}function mn(e,t){return e.styles||e.highlight(Mt,e.stateAfter=oi(R(e)),s.tabSize),e.getContent(s.tabSize,t,s.lineWrapping)}function gn(e){var t={line:0,ch:0};Hn(t,{line:_t.size-1,ch:dn(_t.size-1).text.length},St(e),t,t),zt=!0}function yn(e){var t=[];return _t.iter(0,_t.size,function(e){t.push(e.text)}),t.join(e||"\n")}function bn(e){A.scrollTop!=It&&(It=Ct.scrollTop=A.scrollTop,sr([]))}function wn(e){s.fixedGutter&&at.style.left!=Ct.scrollLeft+"px"&&(at.style.left=Ct.scrollLeft+"px"),Ct.scrollTop!=It&&(It=Ct.scrollTop,A.scrollTop!=It&&(A.scrollTop=It),sr([])),s.onScroll&&s.onScroll(pn)}function En(e){function u(t){g&&(Ct.draggable=!1),qt=!1,l(),c(),Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)<10&&($(t),dr(n.line,n.ch,!0),Zn())}function m(e){if(i=="single")cr(n,e);else if(i=="double"){var t=Er(e);pt(e,d)?cr(t.from,v):cr(d,t.to)}else i=="triple"&&(pt(e,d)?cr(v,mr({line:e.line,ch:0})):cr(d,mr({line:e.line+1,ch:0})))}function y(e){var t=Zr(e,!0);if(t&&!ht(t,a)){Pt||Dn(),a=t,m(t),zt=!1;var n=ir();if(t.line>=n.to||t.line<n.from)f=setTimeout(hi(function(){y(e)}),150)}}function b(e){clearTimeout(f);var t=Zr(e);t&&m(t),$(e),Zn(),zt=!0,w(),l()}lr(Y(e,"shiftKey"));for(var t=Q(e);t!=kt;t=t.parentNode)if(t.parentNode==Nt&&t!=yt)return;for(var t=Q(e);t!=kt;t=t.parentNode)if(t.parentNode==st)return s.onGutterClick&&s.onGutterClick(pn,wt(st.childNodes,t)+Gt,e),$(e);var n=Zr(e);switch(G(e)){case 3:h&&ti(e);return;case 2:n&&dr(n.line,n.ch,!0),setTimeout(Zn,20),$(e);return}if(!n){Q(e)==Ct&&$(e);return}Pt||Dn();var r=+(new Date),i="single";if(Ft&&Ft.time>r-400&&ht(Ft.pos,n))i="triple",$(e),setTimeout(Zn,20),Sr(n.line);else if(jt&&jt.time>r-400&&ht(jt.pos,n)){i="double",Ft={time:r,pos:n},$(e);var o=Er(n);cr(o.from,o.to)}else jt={time:r,pos:n};var a=n,f;if(s.dragDrop&&nt&&!s.readOnly&&!ht(Ht.from,Ht.to)&&!pt(n,Ht.from)&&!pt(Ht.to,n)&&i=="single"){g&&(Ct.draggable=!0);var l=Z(document,"mouseup",hi(u),!0),c=Z(Ct,"drop",hi(u),!0);qt=!0,Ct.dragDrop&&Ct.dragDrop();return}$(e),i=="single"&&dr(n.line,n.ch,!0);var d=Ht.from,v=Ht.to,w=Z(document,"mousemove",hi(function(e){clearTimeout(f),$(e),!p&&!G(e)?b(e):y(e)}),!0),l=Z(document,"mouseup",hi(b),!0)}function Sn(e){for(var t=Q(e);t!=kt;t=t.parentNode)if(t.parentNode==st)return $(e);$(e)}function xn(e){if(s.onDragEvent&&s.onDragEvent(pn,V(e)))return;$(e);var t=Zr(e,!0),n=e.dataTransfer.files;if(!t||s.readOnly)return;if(n&&n.length&&window.FileReader&&window.File){var r=n.length,i=Array(r),o=0,u=function(e,n){var s=new FileReader;s.onload=function(){i[n]=s.result,++o==r&&(t=mr(t),hi(function(){var e=zn(i.join(""),t,t);cr(t,e)})())},s.readAsText(e)};for(var a=0;a<r;++a)u(n[a],a)}else{if(qt&&!pt(t,Ht.from)&&!pt(Ht.to,t))return;try{var i=e.dataTransfer.getData("Text");i&&pi(function(){var e=Ht.from,n=Ht.to;cr(t,t),qt&&zn("",e,n),Wn(i),Zn()})}catch(e){}}}function Tn(e){var t=$n();e.dataTransfer.setData("Text",t),e.dataTransfer.setDragImage&&e.dataTransfer.setDragImage(vt("img"),0,0)}function Nn(e,t){if(typeof e=="string"){e=u[e];if(!e)return!1}var n=Bt;try{s.readOnly&&(Ut=!0),t&&(Bt=null),e(pn)}catch(r){if(r!=tt)throw r;return!1}finally{Bt=n,Ut=!1}return!0}function kn(e){function u(){o=!0}var t=f(s.keyMap),n=t.auto;clearTimeout(Cn),n&&!c(e)&&(Cn=setTimeout(function(){f(s.keyMap)==t&&(s.keyMap=n.call?n.call(null,pn):n)},50));var r=Tt[Y(e,"keyCode")],i=!1;if(r==null||e.altGraphKey)return!1;Y(e,"altKey")&&(r="Alt-"+r),Y(e,"ctrlKey")&&(r="Ctrl-"+r),Y(e,"metaKey")&&(r="Cmd-"+r);var o=!1;return Y(e,"shiftKey")?i=l("Shift-"+r,s.extraKeys,s.keyMap,function(e){return Nn(e,!0)},u)||l(r,s.extraKeys,s.keyMap,function(e){if(typeof e=="string"&&/^go[A-Z]/.test(e))return Nn(e)},u):i=l(r,s.extraKeys,s.keyMap,Nn,u),o&&(i=!1),i&&($(e),ni(),p&&(e.oldKeyCode=e.keyCode,e.keyCode=0)),i}function Ln(e,t){var n=l("'"+t+"'",s.extraKeys,s.keyMap,function(e){return Nn(e,!0)});return n&&($(e),ni()),n}function On(e){Pt||Dn(),p&&e.keyCode==27&&(e.returnValue=!1),sn&&Gn()&&(sn=!1);if(s.onKeyEvent&&s.onKeyEvent(pn,V(e)))return;var t=Y(e,"keyCode");lr(t==16||Y(e,"shiftKey"));var r=kn(e);b&&(An=r?t:null,!r&&t==88&&Y(e,n?"metaKey":"ctrlKey")&&Wn(""))}function Mn(e){sn&&Gn();if(s.onKeyEvent&&s.onKeyEvent(pn,V(e)))return;var t=Y(e,"keyCode"),n=Y(e,"charCode");if(b&&t==An){An=null,$(e);return}if((b&&(!e.which||e.which<10)||E)&&kn(e))return;var r=String.fromCharCode(n==null?t:n);s.electricChars&&Mt.electricChars&&s.smartIndent&&!s.readOnly&&Mt.electricChars.indexOf(r)>-1&&setTimeout(hi(function(){Tr(Ht.to.line,"smart")}),75);if(Ln(e,r))return;Kn()}function _n(e){if(s.onKeyEvent&&s.onKeyEvent(pn,V(e)))return;Y(e,"keyCode")==16&&(Bt=null)}function Dn(){if(s.readOnly=="nocursor")return;Pt||(s.onFocus&&s.onFocus(pn),Pt=!0,Ct.className.search(/\bCodeMirror-focused\b/)==-1&&(Ct.className+=" CodeMirror-focused")),Jn(),ni()}function Pn(){Pt&&(s.onBlur&&s.onBlur(pn),Pt=!1,en&&hi(function(){en&&(en(),en=null)})(),Ct.className=Ct.className.replace(" CodeMirror-focused","")),clearInterval(Ot),setTimeout(function(){Pt||(Bt=null)},150)}function Hn(e,t,n,r,i){if(Ut)return;var o=[];_t.iter(e.line,t.line+1,function(e){o.push(D(e.text,e.markedSpans))});if(un){un.addChange(e.line,n.length,o);while(un.done.length>s.undoDepth)un.done.shift()}var u=O(_(o[0]),_(lt(o)),e.ch,t.ch,n);In(e,t,u,r,i)}function Bn(e,t){if(!e.length)return;var n=e.pop(),r=[];for(var i=n.length-1;i>=0;i-=1){var s=n[i],o=[],u=s.start+s.added;_t.iter(s.start,u,function(e){o.push(D(e.text,e.markedSpans))}),r.push({start:s.start,added:s.old.length,old:o});var a={line:s.start+s.old.length-1,ch:bt(M(lt(o)),M(lt(s.old)))};In({line:s.start,ch:0},{line:u-1,ch:dn(u-1).text.length},s.old,a,a)}zt=!0,t.push(r)}function jn(){Bn(un.done,un.undone)}function Fn(){Bn(un.undone,un.done)}function In(e,t,n,r,i){function w(e){return e<=Math.min(t.line,t.line+g)?e:e+g}if(Ut)return;var o=!1,u=tn.text.length;s.lineWrapping||_t.iter(e.line,t.line+1,function(e){if(!e.hidden&&e.text.length==u)return o=!0,!0});if(e.line!=t.line||n.length>1)Jt=!0;var a=t.line-e.line,f=dn(e.line),l=dn(t.line),c=lt(n);if(e.ch==0&&t.ch==0&&M(c)==""){var h=[],p=null;for(var d=0,v=n.length-1;d<v;++d)h.push(new j(M(n[d]),_(n[d])));l.update(l.text,_(c)),a&&_t.remove(e.line,a,Kt),h.length&&_t.insert(e.line,h)}else if(f==l)if(n.length==1)f.update(f.text.slice(0,e.ch)+M(n[0])+f.text.slice(t.ch),_(n[0]));else{for(var h=[],d=1,v=n.length-1;d<v;++d)h.push(new j(M(n[d]),_(n[d])));h.push(new j(M(c)+f.text.slice(t.ch),_(c))),f.update(f.text.slice(0,e.ch)+M(n[0]),_(n[0])),_t.insert(e.line+1,h)}else if(n.length==1)f.update(f.text.slice(0,e.ch)+M(n[0])+l.text.slice(t.ch),_(n[0])),_t.remove(e.line+1,a,Kt);else{var h=[];f.update(f.text.slice(0,e.ch)+M(n[0]),_(n[0])),l.update(M(c)+l.text.slice(t.ch),_(c));for(var d=1,v=n.length-1;d<v;++d)h.push(new j(M(n[d]),_(n[d])));a>1&&_t.remove(e.line+1,a-1,Kt),_t.insert(e.line+1,h)}if(s.lineWrapping){var m=Math.max(5,Ct.clientWidth/Qr()-3);_t.iter(e.line,e.line+n.length,function(e){if(e.hidden)return;var t=Math.ceil(e.text.length/m)||1;t!=e.height&&vn(e,t)})}else _t.iter(e.line,e.line+n.length,function(e){var t=e.text;!e.hidden&&t.length>u&&(tn=e,u=t.length,rn=!0,o=!1)}),o&&(nn=!0);Dt=Math.min(Dt,e.line),ai(400);var g=n.length-a-1;Xt.push({from:e.line,to:t.line+1,diff:g});if(s.onChange){for(var d=0;d<n.length;++d)typeof n[d]!="string"&&(n[d]=n[d].text);var y={from:e,to:t,text:n};if(Vt){for(var b=Vt;b.next;b=b.next);b.next=y}else Vt=y}hr(mr(r),mr(i),w(Ht.from.line),w(Ht.to.line))}function qn(){var e=_t.height*$r()+2*Gr();return e*.99>Ct.offsetHeight?e:!1}function Rn(e){var t=qn();A.style.display=t?"block":"none",t?(L.style.height=Nt.style.minHeight=t+"px",A.style.height=Ct.clientHeight+"px",e!=null&&(A.scrollTop=Ct.scrollTop=e,g&&setTimeout(function(){if(A.scrollTop!=e)return;A.scrollTop=e+(e?-1:1),A.scrollTop=e},0))):Nt.style.minHeight="",yt.style.top=Qt*$r()+"px"}function Un(){tn=dn(0),rn=!0;var e=tn.text.length;_t.iter(1,_t.size,function(t){var n=t.text;!t.hidden&&n.length>e&&(e=n.length,tn=t)}),nn=!1}function zn(e,t,n){function r(r){if(pt(r,t))return r;if(!pt(n,r))return i;var s=r.line+e.length-(n.line-t.line)-1,o=r.ch;return r.line==n.line&&(o+=lt(e).length-(n.ch-(n.line==t.line?t.ch:0))),{line:s,ch:o}}t=mr(t),n?n=mr(n):n=t,e=St(e);var i;return Xn(e,t,n,function(e){return i=e,{from:r(Ht.from),to:r(Ht.to)}}),i}function Wn(e,t){Xn(St(e),Ht.from,Ht.to,function(e){return t=="end"?{from:e,to:e}:t=="start"?{from:Ht.from,to:Ht.from}:{from:Ht.from,to:e}})}function Xn(e,t,n,r){var i=e.length==1?e[0].length+t.ch:lt(e).length,s=r({line:t.line+e.length-1,ch:i});Hn(t,n,e,s.from,s.to)}function Vn(e,t,n){var r=e.line,i=t.line;if(r==i)return dn(r).text.slice(e.ch,t.ch);var s=[dn(r).text.slice(e.ch)];return _t.iter(r+1,i,function(e){s.push(e.text)}),s.push(dn(i).text.slice(0,t.ch)),s.join(n||"\n")}function $n(e){return Vn(Ht.from,Ht.to,e)}function Jn(){if(sn)return;Lt.set(s.pollInterval,function(){Gn(),Pt&&Jn()})}function Kn(){function t(){var n=Gn();!n&&!e?(e=!0,Lt.set(60,t)):(sn=!1,Jn())}var e=!1;sn=!0,Lt.set(20,t)}function Gn(){if(!Pt||xt(N)||s.readOnly)return!1;var e=N.value;if(e==Qn)return!1;ci||fi(),Bt=null;var t=0,n=Math.min(Qn.length,e.length);while(t<n&&Qn[t]==e[t])++t;return t<Qn.length?Ht.from={line:Ht.from.line,ch:Ht.from.ch-(Qn.length-t)}:Rt&&ht(Ht.from,Ht.to)&&(Ht.to={line:Ht.to.line,ch:Math.min(dn(Ht.to.line).text.length,Ht.to.ch+(e.length-t))}),Wn(e.slice(t),"end"),e.length>1e3?N.value=Qn="":Qn=e,ci||li(),!0}function Yn(e){ht(Ht.from,Ht.to)?e&&(Qn=N.value=""):(Qn="",N.value=$n(),Pt&&ct(N))}function Zn(){s.readOnly!="nocursor"&&N.focus()}function er(){var e=tr();nr(e.x,e.y,e.x,e.yBot);if(!Pt)return;var t=Nt.getBoundingClientRect(),n=null;e.y+t.top<0?n=!0:e.y+t.top+$r()>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1);if(n!=null){var r=B.style.display=="none";r&&(B.style.display="",B.style.left=e.x+"px",B.style.top=e.y-Qt+"px"),B.scrollIntoView(n),r&&(B.style.display="none")}}function tr(){var e=Rr(Ht.inverted?Ht.from:Ht.to),t=s.lineWrapping?Math.min(e.x,rt.offsetWidth):e.x;return{x:t,y:e.y,yBot:e.yBot}}function nr(e,t,n,r){var i=rr(e,t,n,r);i.scrollLeft!=null&&(Ct.scrollLeft=i.scrollLeft),i.scrollTop!=null&&(A.scrollTop=Ct.scrollTop=i.scrollTop)}function rr(e,t,n,r){var i=Yr(),o=Gr();t+=o,r+=o,e+=i,n+=i;var u=Ct.clientHeight,a=A.scrollTop,f={},l=qn()||Infinity,c=t<o+10,h=r+o>l-10;t<a?f.scrollTop=c?0:Math.max(0,t):r>a+u&&(f.scrollTop=(h?l:r)-u);var p=Ct.clientWidth,d=Ct.scrollLeft,v=s.fixedGutter?at.clientWidth:0,m=e<v+i+10;return e<d+v||m?(m&&(e=0),f.scrollLeft=Math.max(0,e-10-v)):n>p+d-3&&(f.scrollLeft=n+10-p),f}function ir(e){var t=$r(),n=(e!=null?e:A.scrollTop)-Gr(),r=Math.max(0,Math.floor(n/t)),i=Math.ceil((n+Ct.clientHeight)/t);return{from:U(_t,r),to:U(_t,i)}}function sr(e,t,n){function d(){var e=P.firstChild,t=!1;return _t.iter(Gt,Yt,function(n){if(!e)return;if(!n.hidden){var r=Math.round(e.offsetHeight/c)||1;n.height!=r&&(vn(n,r),Jt=t=!0)}e=e.nextSibling}),t}if(!Ct.clientWidth){Gt=Yt=Qt=0;return}var r=ir(n);if(e!==!0&&e.length==0&&r.from>Gt&&r.to<Yt){Rn(n);return}var i=Math.max(r.from-100,0),o=Math.min(_t.size,r.to+100);Gt<i&&i-Gt<20&&(i=Gt),Yt>o&&Yt-o<20&&(o=Math.min(_t.size,Yt));var u=e===!0?[]:or([{from:Gt,to:Yt,domStart:0}],e),a=0;for(var f=0;f<u.length;++f){var l=u[f];l.from<i&&(l.domStart+=i-l.from,l.from=i),l.to>o&&(l.to=o),l.from>=l.to?u.splice(f--,1):a+=l.to-l.from}if(a==o-i&&i==Gt&&o==Yt){Rn(n);return}u.sort(function(e,t){return e.domStart-t.domStart});var c=$r(),h=at.style.display;P.style.display="none",ur(i,o,u),P.style.display=at.style.display="";var p=i!=Gt||o!=Yt||Zt!=Ct.clientHeight+c;p&&(Zt=Ct.clientHeight+c),(i!=Gt||o!=Yt&&s.onViewportChange)&&setTimeout(function(){s.onViewportChange&&s.onViewportChange(pn,i,o)}),Gt=i,Yt=o,Qt=z(_t,i),ai(100);if(P.childNodes.length!=Yt-Gt)throw new Error("BAD PATCH! "+JSON.stringify(u)+" size="+(Yt-Gt)+" nodes="+P.childNodes.length);return s.lineWrapping&&d(),at.style.display=h,(p||Jt)&&ar()&&s.lineWrapping&&d()&&ar(),Rn(n),fr(),!t&&s.onUpdate&&s.onUpdate(pn),!0}function or(e,t){for(var n=0,r=t.length||0;n<r;++n){var i=t[n],s=[],o=i.diff||0;for(var u=0,a=e.length;u<a;++u){var f=e[u];i.to<=f.from&&i.diff?s.push({from:f.from+o,to:f.to+o,domStart:f.domStart}):i.to<=f.from||i.from>=f.to?s.push(f):(i.from>f.from&&s.push({from:f.from,to:i.from,domStart:f.domStart}),i.to<f.to&&s.push({from:i.to+o,to:f.to+o,domStart:f.domStart+(i.to-f.from)}))}e=s}return e}function ur(e,t,n){function r(e){var t=e.nextSibling;return e.parentNode.removeChild(e),t}if(!n.length)mt(P);else{var i=0,s=P.firstChild,o;for(var u=0;u<n.length;++u){var a=n[u];while(a.domStart>i)s=r(s),i++;for(var f=0,l=a.to-a.from;f<l;++f)s=s.nextSibling,i++}while(s)s=r(s)}var c=n.shift(),s=P.firstChild,f=e;_t.iter(e,t,function(e){c&&c.to==f&&(c=n.shift());if(!c||c.from>f){if(e.hidden)var t=vt("pre");else{var t=mn(e);e.className&&(t.className=e.className);if(e.bgClassName){var r=vt("pre"," ",e.bgClassName,"position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: -2");t=vt("div",[r,t],null,"position: relative")}}P.insertBefore(t,s)}else s=s.nextSibling;++f})}function ar(){if(!s.gutter&&!s.lineNumbers)return;var e=yt.offsetHeight,t=Ct.clientHeight;at.style.height=(e-t<2?t:e)+"px";var n=document.createDocumentFragment(),r=Gt,i;_t.iter(Gt,Math.max(Yt,Gt+1),function(e){if(e.hidden)n.appendChild(vt("pre"));else{var t=e.gutterMarker,o=s.lineNumbers?s.lineNumberFormatter(r+s.firstLineNumber):null;t&&t.text?o=t.text.replace("%N%",o!=null?o:""):o==null&&(o=" ");var u=n.appendChild(vt("pre",null,t&&t.style));u.innerHTML=o;for(var a=1;a<e.height;++a)u.appendChild(vt("br")),u.appendChild(document.createTextNode(" "));t||(i=r)}++r}),at.style.display="none",gt(st,n);if(i!=null&&s.lineNumbers){var o=st.childNodes[i-Gt],u=String(_t.size).length,a=ut(o.firstChild),f="";while(a.length+f.length<u)f+=" ";f&&o.insertBefore(document.createTextNode(f),o.firstChild)}at.style.display="";var l=Math.abs((parseInt(rt.style.marginLeft)||0)-at.offsetWidth)>2;return rt.style.marginLeft=at.offsetWidth+"px",Jt=!1,l}function fr(){var e=ht(Ht.from,Ht.to),t=Rr(Ht.from,!0),n=e?t:Rr(Ht.to,!0),r=Ht.inverted?t:n,i=$r(),o=ot(kt),u=ot(P);C.style.top=Math.max(0,Math.min(Ct.offsetHeight,r.y+u.top-o.top))+"px",C.style.left=Math.max(0,Math.min(Ct.offsetWidth,r.x+u.left-o.left))+"px";if(e)B.style.top=r.y+"px",B.style.left=(s.lineWrapping?Math.min(r.x,rt.offsetWidth):r.x)+"px",B.style.display="",H.style.display="none";else{var a=t.y==n.y,f=document.createDocumentFragment(),l=rt.clientWidth||rt.offsetWidth,c=rt.clientHeight||rt.offsetHeight,h=function(e,t,n,r){var i=m?"width: "+(n?l-n-e:l)+"px":"right: "+n+"px";f.appendChild(vt("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; "+i+"; height: "+r+"px"))};if(Ht.from.ch&&t.y>=0){var p=a?l-n.x:0;h(t.x,t.y,p,i)}var d=Math.max(0,t.y+(Ht.from.ch?i:0)),v=Math.min(n.y,c)-d;v>.2*i&&h(0,d,0,v),(!a||!Ht.from.ch)&&n.y<c-.5*i&&h(0,n.y,l-n.x,i),gt(H,f),B.style.display="none",H.style.display=""}}function lr(e){e?Bt=Bt||(Ht.inverted?Ht.to:Ht.from):Bt=null}function cr(e,t){var n=Bt&&mr(Bt);n&&(pt(n,e)?e=n:pt(t,n)&&(t=n)),hr(e,t),Wt=!0}function hr(e,t,n,r){on=null,n==null&&(n=Ht.from.line,r=Ht.to.line);if(ht(Ht.from,e)&&ht(Ht.to,t))return;if(pt(t,e)){var i=t;t=e,e=i}if(e.line!=n){var o=pr(e,n,Ht.from.ch);o?e=o:Fr(e.line,!1)}t.line!=r&&(t=pr(t,r,Ht.to.ch)),ht(e,t)?Ht.inverted=!1:ht(e,Ht.to)?Ht.inverted=!1:ht(t,Ht.from)&&(Ht.inverted=!0);if(s.autoClearEmptyLines&&ht(Ht.from,Ht.to)){var u=Ht.inverted?e:t;if(u.line!=Ht.from.line&&Ht.from.line<_t.size){var a=dn(Ht.from.line);/^\s+$/.test(a.text)&&setTimeout(hi(function(){if(a.parent&&/^\s+$/.test(a.text)){var e=R(a);zn("",{line:e,ch:0},{line:e,ch:a.text.length})}},10))}}Ht.from=e,Ht.to=t,$t=!0}function pr(e,t,n){function r(t){var r=e.line+t,i=t==1?_t.size:-1;while(r!=i){var o=dn(r);if(!o.hidden){var u=e.ch;if(s||u>n||u>o.text.length)u=o.text.length;return{line:r,ch:u}}r+=t}}var i=dn(e.line),s=e.ch==i.text.length&&e.ch!=n;return i.hidden?e.line>=t?r(1)||r(-1):r(-1)||r(1):e}function dr(e,t,n){var r=mr({line:e,ch:t||0});(n?cr:hr)(r,r)}function vr(e){return Math.max(0,Math.min(e,_t.size-1))}function mr(e){if(e.line<0)return{line:0,ch:0};if(e.line>=_t.size)return{line:_t.size-1,ch:dn(_t.size-1).text.length};var t=e.ch,n=dn(e.line).text.length;return t==null||t>n?{line:e.line,ch:n}:t<0?{line:e.line,ch:0}:e}function gr(e,t){function o(){for(var t=r+e,n=e<0?-1:_t.size;t!=n;t+=e){var i=dn(t);if(!i.hidden)return r=t,s=i,!0}}function u(t){if(i==(e<0?0:s.text.length)){if(!!t||!o())return!1;i=e<0?s.text.length:0}else i+=e;return!0}var n=Ht.inverted?Ht.from:Ht.to,r=n.line,i=n.ch,s=dn(r);if(t=="char")u();else if(t=="column")u(!0);else if(t=="word"){var a=!1;for(;;){if(e<0&&!u())break;if(Et(s.text.charAt(i)))a=!0;else if(a){e<0&&(e=1,u());break}if(e>0&&!u())break}}return{line:r,ch:i}}function yr(e,t){var n=e<0?Ht.from:Ht.to;if(Bt||ht(Ht.from,Ht.to))n=gr(e,t);dr(n.line,n.ch,!0)}function br(e,t){ht(Ht.from,Ht.to)?e<0?zn("",gr(e,t),Ht.to):zn("",Ht.from,gr(e,t)):zn("",Ht.from,Ht.to),Wt=!0}function wr(e,t){var n=0,r=Rr(Ht.inverted?Ht.from:Ht.to,!0);on!=null&&(r.x=on);if(t=="page")var i=Math.min(Ct.clientHeight,window.innerHeight||document.documentElement.clientHeight),s=Ur(r.x,r.y+i*e);else if(t=="line")var o=$r(),s=Ur(r.x,r.y+.5*o+e*o);t=="page"&&(A.scrollTop+=Rr(s,!0).y-r.y),dr(s.line,s.ch,!0),on=r.x}function Er(e){var t=dn(e.line).text,n=e.ch,r=e.ch;if(t){e.after===!1||r==t.length?--n:++r;var i=t.charAt(n),s=Et(i)?Et:/\s/.test(i)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!Et(e)};while(n>0&&s(t.charAt(n-1)))--n;while(r<t.length&&s(t.charAt(r)))++r}return{from:{line:e.line,ch:n},to:{line:e.line,ch:r}}}function Sr(e){cr({line:e,ch:0},mr({line:e+1,ch:0}))}function xr(e){if(ht(Ht.from,Ht.to))return Tr(Ht.from.line,e);var t=Ht.to.line-(Ht.to.ch?0:1);for(var n=Ht.from.line;n<=t;++n)Tr(n,e)}function Tr(e,t){t||(t="add");if(t=="smart")if(!Mt.indent)t="prev";else var n=oi(e);var r=dn(e),i=r.indentation(s.tabSize),o=r.text.match(/^\s*/)[0],u;t=="smart"&&(u=Mt.indent(n,r.text.slice(o.length),r.text),u==tt&&(t="prev")),t=="prev"?e?u=dn(e-1).indentation(s.tabSize):u=0:t=="add"?u=i+s.indentUnit:t=="subtract"&&(u=i-s.indentUnit),u=Math.max(0,u);var a=u-i,f="",l=0;if(s.indentWithTabs)for(var c=Math.floor(u/s.tabSize);c;--c)l+=s.tabSize,f+="	";l<u&&(f+=ft(u-l)),f!=o&&zn(f,{line:e,ch:0},{line:e,ch:o.length})}function Nr(){Mt=e.getMode(s,s.mode),_t.iter(0,_t.size,function(e){e.stateAfter=null}),Dt=0,ai(100)}function Cr(){var e=s.gutter||s.lineNumbers;at.style.display=e?"":"none",e?Jt=!0:P.parentNode.style.marginLeft=0}function kr(e,t){if(s.lineWrapping){kt.className+=" CodeMirror-wrap";var n=Ct.clientWidth/Qr()-3;_t.iter(0,_t.size,function(e){if(e.hidden)return;var t=Math.ceil(e.text.length/n)||1;t!=1&&vn(e,t)}),rt.style.minWidth=X.style.left=""}else kt.className=kt.className.replace(" CodeMirror-wrap",""),Un(),_t.iter(0,_t.size,function(e){e.height!=1&&!e.hidden&&vn(e,1)});Xt.push({from:0,to:_t.size})}function Lr(){Ct.className=Ct.className.replace(/\s*cm-s-\S+/g,"")+s.theme.replace(/(^|\s)\s*/g," cm-s-")}function Ar(){var e=a[s.keyMap].style;kt.className=kt.className.replace(/\s*cm-keymap-\S+/g,"")+(e?" cm-keymap-"+e:"")}function Or(e,t){this.lines=[],this.type=e,t&&(this.style=t)}function Mr(e,t,n,r){e=mr(e),t=mr(t);var i=new Or("range",n);r&&r.inclusiveLeft&&(i.inclusiveLeft=!0),r&&r.inclusiveRight&&(i.inclusiveRight=!0);var s=e.line;return _t.iter(s,t.line+1,function(n){var r={from:s==e.line?e.ch:null,to:s==t.line?t.ch:null,marker:i};(n.markedSpans||(n.markedSpans=[])).push(r),i.lines.push(n),++s}),Xt.push({from:e.line,to:t.line+1}),i}function _r(e){e=mr(e);var t=new Or("bookmark"),n=dn(e.line),r={from:e.ch,to:e.ch,marker:t};return(n.markedSpans||(n.markedSpans=[])).push(r),t.lines.push(n),t}function Dr(e){e=mr(e);var t=[],n=dn(e.line).markedSpans;if(n)for(var r=0;r<n.length;++r){var i=n[r];(i.from==null||i.from<=e.ch)&&(i.to==null||i.to>=e.ch)&&t.push(i.marker)}return t}function Pr(e,t,n){return typeof e=="number"&&(e=dn(vr(e))),e.gutterMarker={text:t,style:n},Jt=!0,e}function Hr(e){typeof e=="number"&&(e=dn(vr(e))),e.gutterMarker=null,Jt=!0}function Br(e,t){var n=e,r=e;return typeof e=="number"?r=dn(vr(e)):n=R(e),n==null?null:t(r,n)?(Xt.push({from:n,to:n+1}),r):null}function jr(e,t,n){return Br(e,function(e){if(e.className!=t||e.bgClassName!=n)return e.className=t,e.bgClassName=n,!0})}function Fr(e,t){return Br(e,function(e,n){if(e.hidden!=t){e.hidden=t,s.lineWrapping||(t&&e.text.length==tn.text.length?nn=!0:!t&&e.text.length>tn.text.length&&(tn=e,nn=!1)),vn(e,t?0:1);var r=Ht.from.line,i=Ht.to.line;if(t&&(r==n||i==n)){var o=r==n?pr({line:r,ch:0},r,0):Ht.from,u=i==n?pr({line:i,ch:0},i,0):Ht.to;if(!u)return;hr(o,u)}return Jt=!0}})}function Ir(e){if(typeof e=="number"){if(!hn(e))return null;var t=e;e=dn(e);if(!e)return null}else{var t=R(e);if(t==null)return null}var n=e.gutterMarker;return{line:t,handle:e,text:e.text,markerText:n&&n.text,markerClass:n&&n.style,lineClass:e.className,bgClass:e.bgClassName}}function qr(e,t){if(t==0)return{top:0,left:0};var n=s.lineWrapping&&t<e.text.length&&it.test(e.text.slice(t-1,t+1)),r=mn(e,t);gt(J,r);var i=r.anchor,o=i.offsetTop,u=i.offsetLeft;if(p&&o==0&&u==0){var a=vt("span","x");i.parentNode.insertBefore(a,i.nextSibling),o=a.offsetTop}return{top:o,left:u}}function Rr(e,t){var n,r=$r(),i=r*(z(_t,e.line)-(t?Qt:0));if(e.ch==0)n=0;else{var o=qr(dn(e.line),e.ch);n=o.left,s.lineWrapping&&(i+=Math.max(0,o.top))}return{x:n,y:i,yBot:i+r}}function Ur(e,t){function h(e){var t=qr(u,e);if(f){var r=Math.round(t.top/n);return c=r!=l,Math.max(0,t.left+(r-l)*Ct.clientWidth)}return t.left}var n=$r(),r=Qr(),i=Qt+Math.floor(t/n);if(i<0)return{line:0,ch:0};var o=U(_t,i);if(o>=_t.size)return{line:_t.size-1,ch:dn(_t.size-1).text.length};var u=dn(o),a=u.text,f=s.lineWrapping,l=f?i-z(_t,o):0;if(e<=0&&l==0)return{line:o,ch:0};var c=!1,p=0,d=0,v=a.length,m,g=Math.min(v,Math.ceil((e+l*Ct.clientWidth*.9)/r));for(;;){var y=h(g);if(!(y<=e&&g<v)){m=y,v=g;break}g=Math.min(v,Math.ceil(g*1.2))}if(e>m)return{line:o,ch:v};g=Math.floor(v*.8),y=h(g),y<e&&(p=g,d=y);for(;;){if(v-p<=1){var b=e-d<m-e;return{line:o,ch:b?p:v,after:b}}var w=Math.ceil((p+v)/2),E=h(w);E>e?(v=w,m=E,c&&(m+=1e3)):(p=w,d=E)}}function zr(e){var t=Rr(e,!0),n=ot(rt);return{x:n.left+t.x,y:n.top+t.y,yBot:n.top+t.yBot}}function $r(){if(Vr==null){Vr=vt("pre");for(var e=0;e<49;++e)Vr.appendChild(document.createTextNode("x")),Vr.appendChild(vt("br"));Vr.appendChild(document.createTextNode("x"))}var t=P.clientHeight;return t==Xr?Wr:(Xr=t,gt(J,Vr.cloneNode(!0)),Wr=J.firstChild.offsetHeight/50||1,mt(J),Wr)}function Qr(){if(Ct.clientWidth==Kr)return Jr;Kr=Ct.clientWidth;var e=vt("span","x"),t=vt("pre",[e]);return gt(J,t),Jr=e.offsetWidth||10}function Gr(){return rt.offsetTop}function Yr(){return rt.offsetLeft}function Zr(e,t){var n=ot(Ct,!0),r,i;try{r=e.clientX,i=e.clientY}catch(e){return null}if(!t&&(r-n.left>Ct.clientWidth||i-n.top>Ct.clientHeight))return null;var s=ot(rt,!0);return Ur(r-s.left,i-s.top)}function ti(e){function i(){C.style.position="relative",N.style.cssText=r,v&&(A.scrollTop=n),Jn();if(N.selectionStart!=null){clearTimeout(ei);var e=N.value=" "+(ht(Ht.from,Ht.to)?"":N.value),t=0;Qn=" ",N.selectionStart=1,N.selectionEnd=e.length,ei=setTimeout(function i(){Qn==" "&&N.selectionStart==0?hi(u.selectAll)(pn):t++<10?ei=setTimeout(i,500):Yn()},200)}}var t=Zr(e),n=A.scrollTop;if(!t||b)return;(ht(Ht.from,Ht.to)||pt(t,Ht.from)||!pt(t,Ht.to))&&hi(dr)(t.line,t.ch);var r=N.style.cssText;C.style.position="absolute",N.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; "+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",Zn(),Yn(!0),ht(Ht.from,Ht.to)&&(N.value=Qn=" ");if(h){K(e);var s=Z(window,"mouseup",function(){s(),setTimeout(i,20)},!0)}else setTimeout(i,50)}function ni(){clearInterval(Ot);var e=!0;B.style.visibility="",Ot=setInterval(function(){B.style.visibility=(e=!e)?"":"hidden"},s.cursorBlinkRate)}function ii(e){function v(e,t,n){if(!e.text)return;var r=e.styles,i=o?0:e.text.length-1,s;for(var a=o?0:r.length-2,f=o?r.length:-2;a!=f;a+=2*u){var l=r[a];if(r[a+1]!=h){i+=u*l.length;continue}for(var c=o?0:l.length-1,v=o?l.length:-1;c!=v;c+=u,i+=u)if(i>=t&&i<n&&d.test(s=l.charAt(c))){var m=ri[s];if(m.charAt(1)==">"==o)p.push(s);else{if(p.pop()!=m.charAt(0))return{pos:i,match:!1};if(!p.length)return{pos:i,match:!0}}}}}var t=Ht.inverted?Ht.from:Ht.to,n=dn(t.line),r=t.ch-1,i=r>=0&&ri[n.text.charAt(r)]||ri[n.text.charAt(++r)];if(!i)return;var s=i.charAt(0),o=i.charAt(1)==">",u=o?1:-1,a=n.styles;for(var f=r+1,l=0,c=a.length;l<c;l+=2)if((f-=a[l].length)<=0){var h=a[l+1];break}var p=[n.text.charAt(r)],d=/[(){}[\]]/;for(var l=t.line,c=o?Math.min(l+100,_t.size):Math.max(-1,l-100);l!=c;l+=u){var n=dn(l),m=l==t.line,g=v(n,m&&o?r+1:0,m&&!o?r:n.text.length);if(g)break}g||(g={pos:null,match:!1});var h=g.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",y=Mr({line:t.line,ch:r},{line:t.line,ch:r+1},h),b=g.pos!=null&&Mr({line:l,ch:g.pos},{line:l,ch:g.pos+1},h),w=hi(function(){y.clear(),b&&b.clear()});e?setTimeout(w,800):en=w}function si(e){var t,n;for(var r=e,i=e-40;r>i;--r){if(r==0)return 0;var o=dn(r-1);if(o.stateAfter)return r;var u=o.indentation(s.tabSize);if(n==null||t>u)n=r-1,t=u}return n}function oi(e){var t=si(e),n=t&&dn(t-1).stateAfter;return n?n=x(Mt,n):n=T(Mt),_t.iter(t,e,function(r){r.process(Mt,n,s.tabSize),r.stateAfter=t==e-1||t%5==0?x(Mt,n):null}),n}function ui(){if(Dt>=Yt)return;var e=+(new Date)+s.workTime,t=x(Mt,oi(Dt)),n=Dt;_t.iter(Dt,Yt,function(n){Dt>=Gt?(n.highlight(Mt,t,s.tabSize),n.stateAfter=x(Mt,t)):(n.process(Mt,t,s.tabSize),n.stateAfter=Dt%5==0?x(Mt,t):null),++Dt;if(+(new Date)>e)return ai(s.workDelay),!0}),Yt>n&&Dt>=Gt&&hi(function(){Xt.push({from:n,to:Dt})})()}function ai(e){Dt<Yt&&At.set(e,ui)}function fi(){zt=Wt=Vt=null,Xt=[],$t=!1,Kt=[]}function li(){nn&&Un();if(rn&&!s.lineWrapping){var e=X.offsetWidth,t=qr(tn,tn.text.length).left;d||(X.style.left=t+"px",rt.style.minWidth=t+e+"px"),rn=!1}var n,r;if($t){var i=tr();n=rr(i.x,i.y,i.x,i.yBot)}if(Xt.length||n&&n.scrollTop!=null)r=sr(Xt,!0,n&&n.scrollTop);r||($t&&fr(),Jt&&ar()),n&&er(),$t&&ni(),Pt&&(zt===!0||zt!==!1&&$t)&&Yn(Wt),$t&&s.matchBrackets&&setTimeout(hi(function(){en&&(en(),en=null),ht(Ht.from,Ht.to)&&ii(!1)}),20);var o=$t,u=Kt;Vt&&s.onChange&&pn&&s.onChange(pn,Vt),o&&s.onCursorActivity&&s.onCursorActivity(pn);for(var a=0;a<u.length;++a)u[a](pn);r&&s.onUpdate&&s.onUpdate(pn)}function hi(e){return function(){ci++||fi();try{var t=e.apply(this,arguments)}finally{--ci||li()}return t}}function pi(e){un.startCompound();try{return e()}finally{un.endCompound()}}var s={},y=e.defaults;for(var w in y)y.hasOwnProperty(w)&&(s[w]=(i&&i.hasOwnProperty(w)?i:y)[w]);var N=vt("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em");N.setAttribute("wrap","off"),N.setAttribute("autocorrect","off"),N.setAttribute("autocapitalize","off");var C=vt("div",[N],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),L=vt("div",null,"CodeMirror-scrollbar-inner"),A=vt("div",[L],"CodeMirror-scrollbar"),P=vt("div"),H=vt("div",null,null,"position: relative; z-index: -1"),B=vt("pre"," ","CodeMirror-cursor"),X=vt("pre"," ","CodeMirror-cursor","visibility: hidden"),J=vt("div",null,null,"position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden;"),rt=vt("div",[J,B,X,H,P],null,"position: relative; z-index: 0"),st=vt("div",null,"CodeMirror-gutter-text"),at=vt("div",[st],"CodeMirror-gutter"),yt=vt("div",[at,vt("div",[rt],"CodeMirror-lines")],null,"position: relative"),Nt=vt("div",[yt],null,"position: relative"),Ct=vt("div",[Nt],"CodeMirror-scroll");Ct.setAttribute("tabIndex","-1");var kt=vt("div",[C,A,Ct],"CodeMirror"+(s.lineWrapping?" CodeMirror-wrap":""));r.appendChild?r.appendChild(kt):r(kt),Lr(),Ar(),t&&(N.style.width="0px"),g||(Ct.draggable=!0),rt.style.outline="none",s.tabindex!=null&&(N.tabIndex=s.tabindex),s.autofocus&&Zn(),!s.gutter&&!s.lineNumbers&&(at.style.display="none"),E&&(C.style.height="1px",C.style.position="absolute"),S?(A.style.zIndex=-2,A.style.visibility="hidden"):d&&(A.style.minWidth="18px");var Lt=new et,At=new et,Ot,Mt,_t=new I([new F([new j("")])]),Dt=0,Pt;Nr();var Ht={from:{line:0,ch:0},to:{line:0,ch:0},inverted:!1},Bt,jt,Ft,It=0,qt,Rt=!1,Ut=!1,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt=0,Gt=0,Yt=0,Zt=0,en,tn=dn(0),nn=!1,rn=!0,sn=!1,on=null;hi(function(){gn(s.value||""),zt=!1})();var un=new W;Z(Ct,"mousedown",hi(En)),Z(Ct,"dblclick",hi(Sn)),Z(rt,"selectstart",$),h||Z(Ct,"contextmenu",ti),Z(Ct,"scroll",wn),Z(A,"scroll",bn),Z(A,"mousedown",function(){Pt&&setTimeout(Zn,0)});var an=Z(window,"resize",function(){kt.parentNode?sr(!0):an()},!0);Z(N,"keyup",hi(_n)),Z(N,"input",Kn),Z(N,"keydown",hi(On)),Z(N,"keypress",hi(Mn)),Z(N,"focus",Dn),Z(N,"blur",Pn),s.dragDrop&&(Z(Ct,"dragstart",Tn),Z(Ct,"dragenter",fn),Z(Ct,"dragover",fn),Z(Ct,"drop",hi(xn))),Z(Ct,"paste",function(){Zn(),Kn()}),Z(N,"paste",Kn),Z(N,"cut",hi(function(){s.readOnly||Wn("")})),E&&Z(Nt,"mouseup",function(){document.activeElement==N&&N.blur(),Zn()});var ln;try{ln=document.activeElement==N}catch(cn){}ln||s.autofocus?setTimeout(Dn,20):Pn();var pn=kt.CodeMirror={getValue:yn,setValue:hi(gn),getSelection:$n,replaceSelection:hi(Wn),focus:function(){window.focus(),Zn(),Dn(),Kn()},setOption:function(e,t){var n=s[e];s[e]=t,e=="mode"||e=="indentUnit"?Nr():e=="readOnly"&&t=="nocursor"?(Pn(),N.blur()):e=="readOnly"&&!t?Yn(!0):e=="theme"?Lr():e=="lineWrapping"&&n!=t?hi(kr)():e=="tabSize"?sr(!0):e=="keyMap"&&Ar();if(e=="lineNumbers"||e=="gutter"||e=="firstLineNumber"||e=="theme"||e=="lineNumberFormatter")Cr(),sr(!0)},getOption:function(e){return s[e]},undo:hi(jn),redo:hi(Fn),indentLine:hi(function(e,t){typeof t!="string"&&(t==null?t=s.smartIndent?"smart":"prev":t=t?"add":"subtract"),hn(e)&&Tr(e,t)}),indentSelection:hi(xr),historySize:function(){return{undo:un.done.length,redo:un.undone.length}},clearHistory:function(){un=new W},setHistory:function(e){un=new W,un.done=e.done,un.undone=e.undone},getHistory:function(){return un.time=0,{done:un.done.concat([]),undone:un.undone.concat([])}},matchBrackets:hi(function(){ii(!0)}),getTokenAt:hi(function(e){return e=mr(e),dn(e.line).getTokenAt(Mt,oi(e.line),s.tabSize,e.ch)}),getStateAfter:function(e){return e=vr(e==null?_t.size-1:e),oi(e+1)},cursorCoords:function(e,t){return e==null&&(e=Ht.inverted),this.charCoords(e?Ht.from:Ht.to,t)},charCoords:function(e,t){return e=mr(e),t=="local"?Rr(e,!1):t=="div"?Rr(e,!0):zr(e)},coordsChar:function(e){var t=ot(rt);return Ur(e.x-t.left,e.y-t.top)},markText:hi(Mr),setBookmark:_r,findMarksAt:Dr,setMarker:hi(Pr),clearMarker:hi(Hr),setLineClass:hi(jr),hideLine:hi(function(e){return Fr(e,!0)}),showLine:hi(function(e){return Fr(e,!1)}),onDeleteLine:function(e,t){if(typeof e=="number"){if(!hn(e))return null;e=dn(e)}return(e.handlers||(e.handlers=[])).push(t),e},lineInfo:Ir,getViewport:function(){return{from:Gt,to:Yt}},addWidget:function(e,t,n,r,i){e=Rr(mr(e));var s=e.yBot,o=e.x;t.style.position="absolute",Nt.appendChild(t);if(r=="over")s=e.y;else if(r=="near"){var u=Math.max(Ct.offsetHeight,_t.height*$r()),a=Math.max(Nt.clientWidth,rt.clientWidth)-Yr();e.yBot+t.offsetHeight>u&&e.y>t.offsetHeight&&(s=e.y-t.offsetHeight),o+t.offsetWidth>a&&(o=a-t.offsetWidth)}t.style.top=s+Gr()+"px",t.style.left=t.style.right="",i=="right"?(o=Nt.clientWidth-t.offsetWidth,t.style.right="0px"):(i=="left"?o=0:i=="middle"&&(o=(Nt.clientWidth-t.offsetWidth)/2),t.style.left=o+Yr()+"px"),n&&nr(o,s,o+t.offsetWidth,s+t.offsetHeight)},lineCount:function(){return _t.size},clipPos:mr,getCursor:function(e){return e==null&&(e=Ht.inverted),dt(e?Ht.from:Ht.to)},somethingSelected:function(){return!ht(Ht.from,Ht.to)},setCursor:hi(function(e,t,n){t==null&&typeof e.line=="number"?dr(e.line,e.ch,n):dr(e,t,n)}),setSelection:hi(function(e,t,n){(n?cr:hr)(mr(e),mr(t||e))}),getLine:function(e){if(hn(e))return dn(e).text},getLineHandle:function(e){if(hn(e))return dn(e)},setLine:hi(function(e,t){hn(e)&&zn(t,{line:e,ch:0},{line:e,ch:dn(e).text.length})}),removeLine:hi(function(e){hn(e)&&zn("",{line:e,ch:0},mr({line:e+1,ch:0}))}),replaceRange:hi(zn),getRange:function(e,t,n){return Vn(mr
(e),mr(t),n)},triggerOnKeyDown:hi(On),execCommand:function(e){return u[e](pn)},moveH:hi(yr),deleteH:hi(br),moveV:hi(wr),toggleOverwrite:function(){Rt?(Rt=!1,B.className=B.className.replace(" CodeMirror-overwrite","")):(Rt=!0,B.className+=" CodeMirror-overwrite")},posFromIndex:function(e){var t=0,n;return _t.iter(0,_t.size,function(r){var i=r.text.length+1;if(i>e)return n=e,!0;e-=i,++t}),mr({line:t,ch:n})},indexFromPos:function(e){if(e.line<0||e.ch<0)return 0;var t=e.ch;return _t.iter(0,e.line,function(e){t+=e.text.length+1}),t},scrollTo:function(e,t){e!=null&&(Ct.scrollLeft=e),t!=null&&(A.scrollTop=Ct.scrollTop=t),sr([])},getScrollInfo:function(){return{x:Ct.scrollLeft,y:A.scrollTop,height:A.scrollHeight,width:Ct.scrollWidth}},setSize:function(e,t){function n(e){return e=String(e),/^\d+$/.test(e)?e+"px":e}e!=null&&(kt.style.width=n(e)),t!=null&&(Ct.style.height=n(t)),pn.refresh()},operation:function(e){return hi(e)()},compoundChange:function(e){return pi(e)},refresh:function(){sr(!0,null,It),A.scrollHeight>It&&(A.scrollTop=It)},getInputField:function(){return N},getWrapperElement:function(){return kt},getScrollerElement:function(){return Ct},getGutterElement:function(){return at}},Cn,An=null,Qn="";Or.prototype.clear=hi(function(){var e=Infinity,t=-Infinity;for(var n=0;n<this.lines.length;++n){var r=this.lines[n],i=k(r.markedSpans,this,!0);if(i.from!=null||i.to!=null){var s=R(r);e=Math.min(e,s),t=Math.max(t,s)}}e!=Infinity&&Xt.push({from:e,to:t+1}),this.lines.length=0}),Or.prototype.find=function(){var e,t;for(var n=0;n<this.lines.length;++n){var r=this.lines[n],i=k(r.markedSpans,this);if(i.from!=null||i.to!=null){var s=R(r);i.from!=null&&(e={line:s,ch:i.from}),i.to!=null&&(t={line:s,ch:i.to})}}return this.type=="bookmark"?e:e&&{from:e,to:t}};var Wr,Xr,Vr,Jr,Kr=0,ei,ri={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},ci=0;for(var di in o)o.propertyIsEnumerable(di)&&!pn.propertyIsEnumerable(di)&&(pn[di]=o[di]);return pn}function f(e){return typeof e=="string"?a[e]:e}function l(e,t,n,r,i){function s(t){t=f(t);var n=t[e];if(n===!1)return i&&i(),!0;if(n!=null&&r(n))return!0;if(t.nofallthrough)return i&&i(),!0;var o=t.fallthrough;if(o==null)return!1;if(Object.prototype.toString.call(o)!="[object Array]")return s(o);for(var u=0,a=o.length;u<a;++u)if(s(o[u]))return!0;return!1}return t&&s(t)?!0:s(n)}function c(e){var t=Tt[Y(e,"keyCode")];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function x(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var i=t[r];i instanceof Array&&(i=i.concat([])),n[r]=i}return n}function T(e,t,n){return e.startState?e.startState(t,n):!0}function N(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8}function C(e,t,n){this.from=e,this.to=t,this.marker=n}function k(e,t,n){if(e)for(var r=0;r<e.length;++r){var i=e[r];if(i.marker==t)return n&&e.splice(r,1),i}}function L(e,t,n){if(e)for(var r=0,i;r<e.length;++r){var s=e[r],o=s.marker,u=s.from==null||(o.inclusiveLeft?s.from<=t:s.from<t);if(u||o.type=="bookmark"&&s.from==t&&s.from!=n){var a=s.to==null||(o.inclusiveRight?s.to>=t:s.to>t);(i||(i=[])).push({from:s.from,to:a?null:s.to,marker:o})}}return i}function A(e,t){if(e)for(var n=0,r;n<e.length;++n){var i=e[n],s=i.marker,o=i.to==null||(s.inclusiveRight?i.to>=t:i.to>t);if(o||s.type=="bookmark"&&i.from==t){var u=i.from==null||(s.inclusiveLeft?i.from<=t:i.from<t);(r||(r=[])).push({from:u?null:i.from-t,to:i.to==null?null:i.to-t,marker:s})}}return r}function O(e,t,n,r,i){if(!e&&!t)return i;var s=L(e,n),o=A(t,r),u=i.length==1,a=lt(i).length+(u?n:0);if(s)for(var f=0;f<s.length;++f){var l=s[f];if(l.to==null){var c=k(o,l.marker);c?u&&(l.to=c.to==null?null:c.to+a):l.to=n}}if(o)for(var f=0;f<o.length;++f){var l=o[f];l.to!=null&&(l.to+=a);if(l.from==null){var c=k(s,l.marker);c||(l.from=a,u&&(s||(s=[])).push(l))}else l.from+=a,u&&(s||(s=[])).push(l)}var h=[D(i[0],s)];if(!u){var p=i.length-2,d;if(p>0&&s)for(var f=0;f<s.length;++f)s[f].to==null&&(d||(d=[])).push({from:null,to:null,marker:s[f].marker});for(var f=0;f<p;++f)h.push(D(i[f+1],d));h.push(D(lt(i),o))}return h}function M(e){return typeof e=="string"?e:e.text}function _(e){return typeof e=="string"?null:e.markedSpans}function D(e,t){return t?{text:e,markedSpans:t}:e}function P(e){var t=e.markedSpans;if(!t)return;for(var n=0;n<t.length;++n){var r=t[n].marker.lines,i=wt(r,e);r.splice(i,1)}e.markedSpans=null}function H(e,t){if(!t)return;for(var n=0;n<t.length;++n)var r=t[n].marker.lines.push(e);e.markedSpans=t}function j(e,t){this.text=e,this.height=1,H(this,t)}function F(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,r=0;t<n;++t)e[t].parent=this,r+=e[t].height;this.height=r}function I(e){this.children=e;var t=0,n=0;for(var r=0,i=e.length;r<i;++r){var s=e[r];t+=s.chunkSize(),n+=s.height,s.parent=this}this.size=t,this.height=n,this.parent=null}function q(e,t){while(!e.lines)for(var n=0;;++n){var r=e.children[n],i=r.chunkSize();if(t<i){e=r;break}t-=i}return e.lines[t]}function R(e){if(e.parent==null)return null;var t=e.parent,n=wt(t.lines,e);for(var r=t.parent;r;t=r,r=r.parent)for(var i=0,s=r.children.length;;++i){if(r.children[i]==t)break;n+=r.children[i].chunkSize()}return n}function U(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.height;if(t<o){e=s;continue e}t-=o,n+=s.chunkSize()}return n}while(!e.lines);for(var r=0,i=e.lines.length;r<i;++r){var u=e.lines[r],a=u.height;if(t<a)break;t-=a}return n+r}function z(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.chunkSize();if(t<o){e=s;continue e}t-=o,n+=s.height}return n}while(!e.lines);for(var r=0;r<t;++r)n+=e.lines[r].height;return n}function W(){this.time=0,this.done=[],this.undone=[],this.compound=0,this.closed=!1}function X(){K(this)}function V(e){return e.stop||(e.stop=X),e}function $(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function J(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function K(e){$(e),J(e)}function Q(e){return e.target||e.srcElement}function G(e){var t=e.which;return t==null&&(e.button&1?t=1:e.button&2?t=3:e.button&4&&(t=2)),n&&e.ctrlKey&&t==1&&(t=3),t}function Y(e,t){var n=e.override&&e.override.hasOwnProperty(t);return n?e.override[t]:e[t]}function Z(e,t,n,r){if(typeof e.addEventListener=="function"){e.addEventListener(t,n,!1);if(r)return function(){e.removeEventListener(t,n,!1)}}else{var i=function(e){n(e||window.event)};e.attachEvent("on"+t,i);if(r)return function(){e.detachEvent("on"+t,i)}}}function et(){this.id=null}function st(e,t,n){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var r=0,i=0;r<t;++r)e.charAt(r)=="	"?i+=n-i%n:++i;return i}function ot(e,t){try{var n=e.getBoundingClientRect();n={top:n.top,left:n.left}}catch(r){n={top:0,left:0}}if(!t)if(window.pageYOffset==null){var i=document.documentElement||document.body.parentNode;i.scrollTop==null&&(i=document.body),n.top+=i.scrollTop,n.left+=i.scrollLeft}else n.top+=window.pageYOffset,n.left+=window.pageXOffset;return n}function ut(e){return e.textContent||e.innerText||e.nodeValue||""}function ft(e){while(at.length<=e)at.push(lt(at)+" ");return at[e]}function lt(e){return e[e.length-1]}function ct(e){t?(e.selectionStart=0,e.selectionEnd=e.value.length):e.select()}function ht(e,t){return e.line==t.line&&e.ch==t.ch}function pt(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function dt(e){return{line:e.line,ch:e.ch}}function vt(e,t,n,r){var i=document.createElement(e);n&&(i.className=n),r&&(i.style.cssText=r);if(typeof t=="string")yt(i,t);else if(t)for(var s=0;s<t.length;++s)i.appendChild(t[s]);return i}function mt(e){return e.innerHTML="",e}function gt(e,t){mt(e).appendChild(t)}function yt(e,t){v?(e.innerHTML="",e.appendChild(document.createTextNode(t))):e.textContent=t}function bt(e,t){if(!t)return 0;if(!e)return t.length;for(var n=e.length,r=t.length;n>=0&&r>=0;--n,--r)if(e.charAt(n)!=t.charAt(r))break;return r+1}function wt(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]==t)return n;return-1}function Et(e){return/\w/.test(e)||e.toUpperCase()!=e.toLowerCase()}e.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:!1,smartIndent:!0,tabSize:4,keyMap:"default",extraKeys:null,electricChars:!0,autoClearEmptyLines:!1,onKeyEvent:null,onDragEvent:null,lineWrapping:!1,lineNumbers:!1,gutter:!1,fixedGutter:!1,firstLineNumber:1,readOnly:!1,dragDrop:!0,onChange:null,onCursorActivity:null,onViewportChange:null,onGutterClick:null,onUpdate:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:!1,cursorBlinkRate:530,workTime:100,workDelay:200,pollInterval:100,undoDepth:40,tabindex:null,autofocus:null,lineNumberFormatter:function(e){return e}};var t=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),n=t||/Mac/.test(navigator.platform),r=/Win/.test(navigator.platform),i=e.modes={},s=e.mimeModes={};e.defineMode=function(t,n){!e.defaults.mode&&t!="null"&&(e.defaults.mode=t);if(arguments.length>2){n.dependencies=[];for(var r=2;r<arguments.length;++r)n.dependencies.push(arguments[r])}i[t]=n},e.defineMIME=function(e,t){s[e]=t},e.resolveMode=function(t){if(typeof t=="string"&&s.hasOwnProperty(t))t=s[t];else if(typeof t=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return typeof t=="string"?{name:t}:t||{name:"null"}},e.getMode=function(t,n){var n=e.resolveMode(n),r=i[n.name];return r?r(t,n):e.getMode(t,"text/plain")},e.listModes=function(){var e=[];for(var t in i)i.propertyIsEnumerable(t)&&e.push(t);return e},e.listMIMEs=function(){var e=[];for(var t in s)s.propertyIsEnumerable(t)&&e.push({mime:t,mode:s[t]});return e};var o=e.extensions={};e.defineExtension=function(e,t){o[e]=t};var u=e.commands={selectAll:function(e){e.setSelection({line:0,ch:0},{line:e.lineCount()-1})},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),r=!ht(t,n);!r&&e.getLine(t.line).length==t.ch?e.replaceRange("",t,{line:t.line+1,ch:0}):e.replaceRange("",t,r?n:{line:t.line})},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",{line:t,ch:0},{line:t})},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.setCursor(0,0,!0)},goDocEnd:function(e){e.setSelection({line:e.lineCount()-1},null,!0)},goLineStart:function(e){e.setCursor(e.getCursor().line,0,!0)},goLineStartSmart:function(e){var t=e.getCursor(),n=e.getLine(t.line),r=Math.max(0,n.search(/\S/));e.setCursor(t.line,t.ch<=r&&t.ch?0:r,!0)},goLineEnd:function(e){e.setSelection({line:e.getCursor().line},null,!0)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goWordRight:function(e){e.moveH(1,"word")},delCharLeft:function(e){e.deleteH(-1,"char")},delCharRight:function(e){e.deleteH(1,"char")},delWordLeft:function(e){e.deleteH(-1,"word")},delWordRight:function(e){e.deleteH(1,"word")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);t.ch>0&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),{line:t.line,ch:t.ch-1},{line:t.line,ch:t.ch+1})},newlineAndIndent:function(e){e.replaceSelection("\n","end"),e.indentLine(e.getCursor().line)},toggleOverwrite:function(e){e.toggleOverwrite()}},a=e.keyMap={};a.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharRight",Backspace:"delCharLeft",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},a.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordLeft","Ctrl-Delete":"delWordRight","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},a.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordLeft","Ctrl-Alt-Backspace":"delWordRight","Alt-Delete":"delWordRight","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},a["default"]=n?a.macDefault:a.pcDefault,a.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageUp","Shift-Ctrl-V":"goPageDown","Ctrl-D":"delCharRight","Ctrl-H":"delCharLeft","Alt-D":"delWordRight","Alt-Backspace":"delWordLeft","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},e.fromTextArea=function(t,n){function s(){t.value=a.getValue()}n||(n={}),n.value=t.value,!n.tabindex&&t.tabindex&&(n.tabindex=t.tabindex);if(n.autofocus==null){var r=document.body;try{r=document.activeElement}catch(i){}n.autofocus=r==t||t.getAttribute("autofocus")!=null&&r==document.body}if(t.form){var o=Z(t.form,"submit",s,!0);if(typeof t.form.submit=="function"){var u=t.form.submit;t.form.submit=function f(){s(),t.form.submit=u,t.form.submit(),t.form.submit=f}}}t.style.display="none";var a=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},n);return a.save=s,a.getTextArea=function(){return t},a.toTextArea=function(){s(),t.parentNode.removeChild(a.getWrapperElement()),t.style.display="",t.form&&(o(),typeof t.form.submit=="function"&&(t.form.submit=u))},a};var h=/gecko\/\d{7}/i.test(navigator.userAgent),p=/MSIE \d/.test(navigator.userAgent),d=/MSIE [1-7]\b/.test(navigator.userAgent),v=/MSIE [1-8]\b/.test(navigator.userAgent),m=p&&document.documentMode==5,g=/WebKit\//.test(navigator.userAgent),y=/Chrome\//.test(navigator.userAgent),b=/Opera\//.test(navigator.userAgent),w=/Apple Computer/.test(navigator.vendor),E=/KHTML\//.test(navigator.userAgent),S=/Mac OS X 10\D([7-9]|\d\d)\D/.test(navigator.userAgent);e.copyState=x,e.startState=T,N.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if(typeof e=="string")var n=t==e;else var n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){var t=this.pos;while(this.eat(e));return this.pos>t},eatSpace:function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return st(this.string,this.start,this.tabSize)},indentation:function(){return st(this.string,null,this.tabSize)},match:function(e,t,n){if(typeof e!="string"){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&t!==!1&&(this.pos+=i[0].length),i)}var r=function(e){return n?e.toLowerCase():e};if(r(this.string).indexOf(r(e),this.pos)==this.pos)return t!==!1&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},e.StringStream=N;var B=" ";h||p&&!d?B="​":b&&(B=""),j.prototype={update:function(e,t){this.text=e,this.stateAfter=this.styles=null,P(this),H(this,t)},highlight:function(e,t,n){var r=new N(this.text,n),i=this.styles||(this.styles=[]),s=i.length=0;this.text==""&&e.blankLine&&e.blankLine(t);while(!r.eol()){var o=e.token(r,t),u=r.current();r.start=r.pos,s&&i[s-1]==o?i[s-2]+=u:u&&(i[s++]=u,i[s++]=o);if(r.pos>5e3){i[s++]=this.text.slice(r.pos),i[s++]=null;break}}},process:function(e,t,n){var r=new N(this.text,n);this.text==""&&e.blankLine&&e.blankLine(t);while(!r.eol()&&r.pos<=5e3)e.token(r,t),r.start=r.pos},getTokenAt:function(e,t,n,r){var i=this.text,s=new N(i,n);while(s.pos<r&&!s.eol()){s.start=s.pos;var o=e.token(s,t)}return{start:s.start,end:s.pos,string:s.current(),className:o||null,state:t}},indentation:function(e){return st(this.text,null,e)},getContent:function(e,t,n){function u(t,n,o){if(!n)return;r&&p&&n.charAt(0)==" "&&(n=" "+n.slice(1)),r=!1;if(!s.test(n)){i+=n.length;var u=document.createTextNode(n)}else{var u=document.createDocumentFragment(),a=0;for(;;){s.lastIndex=a;var f=s.exec(n),l=f?f.index-a:n.length-a;l&&(u.appendChild(document.createTextNode(n.slice(a,a+l))),i+=l);if(!f)break;a+=l+1;if(f[0]=="	"){var c=e-i%e;u.appendChild(vt("span",ft(c),"cm-tab")),i+=c}else{var h=vt("span","•","cm-invalidchar");h.title="\\u"+f[0].charCodeAt(0).toString(16),u.appendChild(h),i+=1}}}o?t.appendChild(vt("span",[u],o)):t.appendChild(u)}function m(e){return e?"cm-"+e.replace(/ +/g," cm-"):null}var r=!0,i=0,s=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g,o=vt("pre"),a=u;if(t!=null){var f=0,l=o.anchor=vt("span");a=function(e,r,i){var s=r.length;if(t>=f&&t<f+s){t>f&&(u(e,r.slice(0,t-f),i),n&&e.appendChild(vt("wbr"))),e.appendChild(l);var o=t-f;u(l,b?r.slice(o,o+1):r.slice(o),i),b&&u(e,r.slice(o+1),i),t--,f+=s}else f+=s,u(e,r,i),f==t&&f==v?(yt(l,B),e.appendChild(l)):f>t+10&&/\s/.test(r)&&(a=function(){})}}var c=this.styles,h=this.text,d=this.markedSpans,v=h.length;if(!h&&t==null)a(o," ");else if(!d||!d.length)for(var g=0,y=0;y<v;g+=2){var w=c[g],E=c[g+1],S=w.length;y+S>v&&(w=w.slice(0,v-y)),y+=S,a(o,w,m(E))}else{d.sort(function(e,t){return e.from-t.from});var x=0,g=0,T="",E,N=0,C=d[0].from||0,k=[],L=0,A=function(){var e;while(L<d.length&&((e=d[L]).from==x||e.from==null))e.marker.style!=null&&k.push(e),++L;C=L<d.length?d[L].from:Infinity;for(var t=0;t<k.length;++t){var n=k[t].to;n==null&&(n=Infinity),n==x?k.splice(t--,1):C=Math.min(n,C)}},O=0;while(x<v){C==x&&A();var M=Math.min(v,C);for(;;){if(T){var _=x+T.length,D=E;for(var P=0;P<k.length;++P)D=(D?D+" ":"")+k[P].marker.style;a(o,_>M?T.slice(0,M-x):T,D);if(_>=M){T=T.slice(M-x),x=M;break}x=_}T=c[g++],E=m(c[g++])}}}return o},cleanUp:function(){this.parent=null,P(this)}},F.prototype={chunkSize:function(){return this.lines.length},remove:function(e,t,n){for(var r=e,i=e+t;r<i;++r){var s=this.lines[r];this.height-=s.height,s.cleanUp();if(s.handlers)for(var o=0;o<s.handlers.length;++o)n.push(s.handlers[o])}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertHeight:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0,i=t.length;r<i;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;e<r;++e)if(n(this.lines[e]))return!0}},I.prototype={chunkSize:function(){return this.size},remove:function(e,t,n){this.size-=t;for(var r=0;r<this.children.length;++r){var i=this.children[r],s=i.chunkSize();if(e<s){var o=Math.min(t,s-e),u=i.height;i.remove(e,o,n),this.height-=u-i.height,s==o&&(this.children.splice(r--,1),i.parent=null);if((t-=o)==0)break;e=0}else e-=s}if(this.size-t<25){var a=[];this.collapse(a),this.children=[new F(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0,n=this.children.length;t<n;++t)this.children[t].collapse(e)},insert:function(e,t){var n=0;for(var r=0,i=t.length;r<i;++r)n+=t[r].height;this.insertHeight(e,t,n)},insertHeight:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<=o){s.insertHeight(e,t,n);if(s.lines&&s.lines.length>50){while(s.lines.length>50){var u=s.lines.splice(s.lines.length-25,25),a=new F(u);s.height-=a.height,this.children.splice(r+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(this.children.length<=10)return;var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new I(t);if(!e.parent){var r=new I(e.children);r.parent=e,e.children=[r,n],e=r}else{e.size-=n.size,e.height-=n.height;var i=wt(e.parent.children,e);e.parent.children.splice(i+1,0,n)}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iter:function(e,t,n){this.iterN(e,t-e,n)},iterN:function(e,t,n){for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<o){var u=Math.min(t,o-e);if(s.iterN(e,u,n))return!0;if((t-=u)==0)break;e=0}else e-=o}}},W.prototype={addChange:function(e,t,n){this.undone.length=0;var r=+(new Date),i=lt(this.done),s=i&&lt(i),o=r-this.time;if(this.compound&&i&&!this.closed)i.push({start:e,added:t,old:n});else if(o>400||!s||this.closed||s.start>e+n.length||s.start+s.added<e)this.done.push([{start:e,added:t,old:n}]),this.closed=!1;else{var u=Math.max(0,s.start-e),a=Math.max(0,e+n.length-(s.start+s.added));for(var f=u;f>0;--f)s.old.unshift(n[f-1]);for(var f=a;f>0;--f)s.old.push(n[n.length-f]);u&&(s.start=e),s.added+=t-(n.length-u-a)}this.time=r},startCompound:function(){this.compound++||(this.closed=!0)},endCompound:function(){--this.compound||(this.closed=!0)}},e.e_stop=K,e.e_preventDefault=$,e.e_stopPropagation=J,e.connect=Z,et.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}};var tt=e.Pass={toString:function(){return"CodeMirror.Pass"}},nt=function(){if(v)return!1;var e=vt("div");return"draggable"in e||"dragDrop"in e}(),rt=function(){var e=vt("textarea");return e.value="foo\nbar",e.value.indexOf("\r")>-1?"\r\n":"\n"}(),it=/^$/;h?it=/$'/:w?it=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:y&&(it=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/);var at=[""],St="\n\nb".split(/\n/).length!=3?function(e){var t=0,n=[],r=e.length;while(t<=r){var i=e.indexOf("\n",t);i==-1&&(i=e.length);var s=e.slice(t,e.charAt(i-1)=="\r"?i-1:i),o=s.indexOf("\r");o!=-1?(n.push(s.slice(0,o)),t+=o+1):(n.push(s),t=i+1)}return n}:function(e){return e.split(/\r\n?|\n/)};e.splitLines=St;var xt=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return!t||t.parentElement()!=e?!1:t.compareEndPoints("StartToEnd",t)!=0};e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var Tt={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};return e.keyNames=Tt,function(){for(var e=0;e<10;e++)Tt[e+48]=String(e);for(var e=65;e<=90;e++)Tt[e]=String.fromCharCode(e);for(var e=1;e<=12;e++)Tt[e+111]=Tt[e+63235]="F"+e}(),e.version="2.33 +",e}(),CodeMirror.defineMode("xml",function(e,t){function u(e,t){function n(n){return t.tokenize=n,n(e,t)}var r=e.next();if(r=="<"){if(e.eat("!"))return e.eat("[")?e.match("CDATA[")?n(l("atom","]]>")):null:e.match("--")?n(l("comment","-->")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),n(c(1))):null;if(e.eat("?"))return e.eatWhile(/[\w\._\-]/),t.tokenize=l("meta","?>"),"meta";o=e.eat("/")?"closeTag":"openTag",e.eatSpace(),s="";var i;while(i=e.eat(/[^\s\u00a0=<>\"\'\/?]/))s+=i;return t.tokenize=a,"tag"}if(r=="&"){var u;return e.eat("#")?e.eat("x")?u=e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):u=e.eatWhile(/[\d]/)&&e.eat(";"):u=e.eatWhile(/[\w\.\-:]/)&&e.eat(";"),u?"atom":"error"}return e.eatWhile(/[^&<]/),null}function a(e,t){var n=e.next();return n==">"||n=="/"&&e.eat(">")?(t.tokenize=u,o=n==">"?"endTag":"selfcloseTag","tag"):n=="="?(o="equals",null):/[\'\"]/.test(n)?(t.tokenize=f(n),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function f(e){return function(t,n){while(!t.eol())if(t.next()==e){n.tokenize=a;break}return"string"}}function l(e,t){return function(n,r){while(!n.eol()){if(n.match(t)){r.tokenize=u;break}n.next()}return e}}function c(e){return function(t,n){var r;while((r=t.next())!=null){if(r=="<")return n.tokenize=c(e+1),n.tokenize(t,n);if(r==">"){if(e==1){n.tokenize=u;break}return n.tokenize=c(e-1),n.tokenize(t,n)}}return"meta"}}function d(){for(var e=arguments.length-1;e>=0;e--)h.cc.push(arguments[e])}function v(){return d.apply(null,arguments),!0}function m(e,t){var n=r.doNotIndent.hasOwnProperty(e)||h.context&&h.context.noIndent;h.context={prev:h.context,tagName:e,indent:h.indented,startOfLine:t,noIndent:n}}function g(){h.context&&(h.context=h.context.prev)}function y(e){if(e=="openTag")return h.tagName=s,v(S,b(h.startOfLine));if(e=="closeTag"){var t=!1;return h.context?h.context.tagName!=s&&(r.implicitlyClosed.hasOwnProperty(h.context.tagName.toLowerCase())&&g(),t=!h.context||h.context.tagName!=s):t=!0,t&&(p="error"),v(w(t))}return v()}function b(e){return function(t){return t=="selfcloseTag"||t=="endTag"&&r.autoSelfClosers.hasOwnProperty(h.tagName.toLowerCase())?(E(h.tagName.toLowerCase()),v()):t=="endTag"?(E(h.tagName.toLowerCase()),m(h.tagName,e),v()):v()}}function w(e){return function(t){return e&&(p="error"),t=="endTag"?(g(),v()):(p="error",v(arguments.callee))}}function E(e){var t;for(;;){if(!h.context)return;t=h.context.tagName.toLowerCase();if(!r.contextGrabbers.hasOwnProperty(t)||!r.contextGrabbers[t].hasOwnProperty(e))return;g()}}function S(e){return e=="word"?(p="attribute",v(x,S)):e=="endTag"||e=="selfcloseTag"?d():(p="error",v(S))}function x(e){return e=="equals"?v(T,S):(r.allowMissing||(p="error"),e=="endTag"||e=="selfcloseTag"?d():v())}function T(e){return e=="string"?v(N):e=="word"&&r.allowUnquoted?(p="string",v()):(p="error",e=="endTag"||e=="selfCloseTag"?d():v())}function N(e){return e=="string"?v(N):d()}var n=e.indentUnit,r=t.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1},i=t.alignCDATA,s,o,h,p;return{startState:function(){return{tokenize:u,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(e,t){e.sol()&&(t.startOfLine=!0,t.indented=e.indentation());if(e.eatSpace())return null;p=o=s=null;var n=t.tokenize(e,t);t.type=o;if((n||o)&&n!="comment"){h=t;for(;;){var r=t.cc.pop()||y;if(r(o||n))break}}return t.startOfLine=!1,p||n},indent:function(e,t,r){var s=e.context;if(e.tokenize!=a&&e.tokenize!=u||s&&s.noIndent)return r?r.match(/^(\s*)/)[0].length:0;if(i&&/<!\[CDATA\[/.test(t))return 0;s&&/^<\//.test(t)&&(s=s.prev);while(s&&!s.startOfLine)s=s.prev;return s?s.indent+n:0},electricChars:"/"}}),CodeMirror.defineMIME("text/xml","xml"),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.mimeModes.hasOwnProperty("text/html")||CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0}),function(e,t){function n(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function r(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}function i(t,n){var r=t,i=null;return e.getComputedStyle?i=document.defaultView.getComputedStyle(r,null).getPropertyValue(n):r.currentStyle&&(i=r.currentStyle[n]),i}function s(e,t,n){var s={},o;if(t==="save"){for(o in n)n.hasOwnProperty(o)&&(s[o]=i(e,o));r(e,n)}else t==="apply"&&r(e,n);return s}function o(e){var t=parseInt(i(e,"border-left-width"),10)+parseInt(i(e,"border-right-width"),10),n=parseInt(i(e,"padding-left"),10)+parseInt(i(e,"padding-right"),10),r=e.offsetWidth,s;return isNaN(t)&&(t=0),s=t+n+r,s}function u(e){var t=parseInt(i(e,"border-top-width"),10)+parseInt(i(e,"border-bottom-width"),10),n=parseInt(i(e,"padding-top"),10)+parseInt(i(e,"padding-bottom"),10),r=e.offsetHeight,s;return isNaN(t)&&(t=0),s=t+n+r,s}function a(e,t,r){r=r||"";var i=t.getElementsByTagName("head")[0],s=t.createElement("link");n(s,{type:"text/css",id:r,rel:"stylesheet",href:e,name:e,media:"screen"}),i.appendChild(s)}function f(e,t,n){e.className=e.className.replace(t,n)}function l(e){return e.contentDocument||e.contentWindow.document}function c(e){var t;return document.body.innerText?t=e.innerText:(t=e.innerHTML.replace(/<br>/gi,"\n"),t=t.replace(/<(?:.|\n)*?>/gm,""),t=t.replace(/&lt;/gi,"<"),t=t.replace(/&gt;/gi,">")),t}function h(e,t){return document.body.innerText?e.innerText=t:e.innerHTML=t.replace(/\n/g,"<br>"),!0}function p(){var e=-1,t=navigator.userAgent,n;return navigator.appName=="Microsoft Internet Explorer"&&(n=/MSIE ([0-9]{1,}[\.0-9]{0,})/,n.exec(t)!=null&&(e=parseFloat(RegExp.$1,10))),e}function d(e){var t={};return e&&t.toString.call(e)==="[object Function]"}function v(){var e=arguments[0]||{},n=1,r=arguments.length,i=!1,s,o,u,a;typeof e=="boolean"&&(i=e,e=arguments[1]||{},n=2),typeof e!="object"&&!d(e)&&(e={}),r===n&&(e=this,--n);for(;n<r;n++)if((s=arguments[n])!=null)for(o in s)if(s.hasOwnProperty(o)){u=e[o],a=s[o];if(e===a)continue;i&&a&&typeof a=="object"&&!a.nodeType?e[o]=v(i,u||(a.length!=null?[]:{}),a):a!==t&&(e[o]=a)}return e}function m(e){var n=this,r=e||{},i,s,o={container:"epiceditor",basePath:"epiceditor",clientSideStorage:!0,localStorageName:"epiceditor",file:{name:null,defaultContent:"",autoSave:100},theme:{base:"/themes/base/epiceditor.css",preview:"/themes/preview/github.css",editor:"/themes/editor/epic-dark.css"},focusOnLoad:!1,shortcut:{modifier:18,fullscreen:70,preview:80,edit:79},parser:typeof marked=="function"?marked:null},u;n.settings=v(!0,o,r);if(typeof n.settings.parser!="function"||typeof n.settings.parser("TEST")!="string")n.settings.parser=function(e){return e};return typeof n.settings.container=="string"?n.element=document.getElementById(n.settings.container):typeof n.settings.container=="object"&&(n.element=n.settings.container),n.settings.file.name||(typeof n.settings.container=="string"?n.settings.file.name=n.settings.container:typeof n.settings.container=="object"&&(n.element.id?n.settings.file.name=n.element.id:(m._data.unnamedEditors||(m._data.unnamedEditors=[]),m._data.unnamedEditors.push(n),n.settings.file.name="__epiceditor-untitled-"+m._data.unnamedEditors.length))),n._instanceId="epiceditor-"+Math.round(Math.random()*1e5),n._storage={},n._canSave=!0,n._defaultFileSchema=function(){return{content:n.settings.file.defaultContent,created:new Date,modified:new Date}},localStorage&&n.settings.clientSideStorage&&(this._storage=localStorage,this._storage[n.settings.localStorageName]&&n.getFiles(n.settings.file.name)===t&&(s=n.getFiles(n.settings.file.name),s=n._defaultFileSchema(),s.content=n.settings.file.defaultContent)),this._storage[n.settings.localStorageName]||(u={},u[n.settings.file.name]=n._defaultFileSchema(),u=JSON.stringify(u),this._storage[n.settings.localStorageName]=u),n.events||(n.events={}),this}m.prototype.load=function(t){function _(e){for(var t=0;t<e.length;t++)e[t].style.width=n.element.offsetWidth-d+"px",e[t].style.height=n.element.offsetHeight-v+"px"}function D(e){d=o(n.element)-n.element.offsetWidth;for(var t=0;t<e.length;t++)e[t].style.width=n.element.offsetWidth-d+"px"}function P(t){if(Math.abs(w.y-t.pageY)>=5||Math.abs(w.x-t.pageX)>=5)g.style.display="block",y&&clearTimeout(y),y=e.setTimeout(function(){g.style.display="none"},1e3);w={y:t.pageY,x:t.pageX}}function H(e){e.keyCode==n.settings.shortcut.
modifier&&(L=!0),e.keyCode==17&&(A=!0),L===!0&&e.keyCode==n.settings.shortcut.preview&&!n.eeState.fullscreen&&(e.preventDefault(),n.preview()),L===!0&&e.keyCode==n.settings.shortcut.edit&&(e.preventDefault(),n.eeState.fullscreen||n.edit()),L===!0&&e.keyCode==n.settings.shortcut.fullscreen&&(e.preventDefault(),T(k)),L===!0&&e.keyCode!==n.settings.shortcut.modifier&&(L=!1),e.keyCode==27&&n.eeState.fullscreen&&(document.body.webkitRequestFullScreen||N(k)),A===!0&&e.keyCode==83&&(n.save(),e.preventDefault(),A=!1),e.metaKey&&e.keyCode==83&&(n.save(),e.preventDefault())}function B(e){e.keyCode==n.settings.shortcut.modifier&&(L=!1),e.keyCode==17&&(A=!1)}var n=this,f,c,h,d,v,m,g,y,b,w={y:-1,x:-1},E,S,x=document.body.webkitRequestFullScreen?!0:!1,T,N,C,k,L=!1,A=!1,O,M;t=t||function(){},n.eeState={fullscreen:!1,preview:!1,edit:!0,loaded:!1,unloaded:!1},f={chrome:'<div id="epiceditor-wrapper" class="epiceditor-edit-mode"><iframe frameborder="0" id="epiceditor-editor-frame"></iframe><iframe frameborder="0" id="epiceditor-previewer-frame"></iframe><div id="epiceditor-utilbar"><img width="30" src="'+this.settings.basePath+'/images/preview.png" title="Toggle Preview Mode" class="epiceditor-toggle-btn epiceditor-toggle-preview-btn"> '+'<img width="30" src="'+this.settings.basePath+'/images/edit.png" title="Toggle Edit Mode" class="epiceditor-toggle-btn epiceditor-toggle-edit-btn"> '+'<img width="30" src="'+this.settings.basePath+'/images/fullscreen.png" title="Enter Fullscreen" class="epiceditor-fullscreen-btn">'+"</div>"+"</div>",previewer:'<div id="epiceditor-preview"></div>'},n.element.innerHTML='<iframe scrolling="no" frameborder="0" id= "'+n._instanceId+'"></iframe>',c=document.getElementById(n._instanceId),n.iframeElement=c,n.iframe=l(c),n.iframe.open(),n.iframe.write(f.chrome),n.editorIframe=n.iframe.getElementById("epiceditor-editor-frame"),n.previewerIframe=n.iframe.getElementById("epiceditor-previewer-frame"),n.editorIframeDocument=l(n.editorIframe),n.editorIframeDocument.open(),n.editorIframeDocument.write(""),n.editorIframeDocument.close(),n.previewerIframeDocument=l(n.previewerIframe),n.previewerIframeDocument.open(),n.previewerIframeDocument.write(f.previewer),h=n.previewerIframeDocument.createElement("base"),h.target="_blank",n.previewerIframeDocument.getElementsByTagName("head")[0].appendChild(h),n.previewerIframeDocument.close(),d=o(n.element)-n.element.offsetWidth,v=u(n.element)-n.element.offsetHeight,C=[n.iframeElement,n.editorIframe,n.previewerIframe],_(C),a(n.settings.basePath+n.settings.theme.base,n.iframe,"theme"),a(n.settings.basePath+n.settings.theme.editor,n.editorIframeDocument,"theme"),a(n.settings.basePath+n.settings.theme.preview,n.previewerIframeDocument,"theme"),n.iframe.getElementById("epiceditor-wrapper").style.position="relative",n.editor=n.editorIframeDocument.body,n.previewer=n.previewerIframeDocument.getElementById("epiceditor-preview"),n.editor.contentEditable=!0,n.iframe.body.style.height=this.element.offsetHeight+"px",this.previewerIframe.style.display="none",p()>-1&&(this.previewer.style.height=parseInt(i(this.previewer,"height"),10)+2),this.open(n.settings.file.name),n.settings.focusOnLoad&&n.iframe.addEventListener("readystatechange",function(){n.iframe.readyState=="complete"&&n.editorIframeDocument.body.focus()}),m=n.iframe.getElementById("epiceditor-utilbar"),E={},T=function(t){if(n.eeState.fullscreen){N(t);return}x&&t.webkitRequestFullScreen(),S=n.eeState.edit,n.eeState.fullscreen=!0,n.eeState.edit=!0,n.eeState.preview=!0;var r=e.innerWidth,o=e.innerHeight,u=e.outerWidth,a=e.outerHeight;x||(a=e.innerHeight),E.editorIframe=s(n.editorIframe,"save",{width:u/2+"px",height:a+"px","float":"left",cssFloat:"left",styleFloat:"left",display:"block"}),E.previewerIframe=s(n.previewerIframe,"save",{width:u/2+"px",height:a+"px","float":"right",cssFloat:"right",styleFloat:"right",display:"block"}),E.element=s(n.element,"save",{position:"fixed",top:"0",left:"0",width:"100%","z-index":"9999",zIndex:"9999",border:"none",margin:"0",background:i(n.editor,"background-color"),height:o+"px"}),E.iframeElement=s(n.iframeElement,"save",{width:u+"px",height:o+"px"}),m.style.visibility="hidden",x||(document.body.style.overflow="hidden"),n.preview(),n.editorIframeDocument.body.focus()},N=function(e){s(n.element,"apply",E.element),s(n.iframeElement,"apply",E.iframeElement),s(n.editorIframe,"apply",E.editorIframe),s(n.previewerIframe,"apply",E.previewerIframe),n.element.style.width="",n.element.style.height="",m.style.visibility="visible",x?document.webkitCancelFullScreen():document.body.style.overflow="auto",n.eeState.fullscreen=!1,S?n.edit():n.preview(),D(C)},n.editor.addEventListener("keyup",function(){b&&e.clearTimeout(b),b=e.setTimeout(function(){n.eeState.fullscreen&&n.preview()},250)}),k=n.iframeElement,m.addEventListener("click",function(e){var t=e.target.className;t.indexOf("epiceditor-toggle-preview-btn")>-1?n.preview():t.indexOf("epiceditor-toggle-edit-btn")>-1?n.edit():t.indexOf("epiceditor-fullscreen-btn")>-1&&T(k)}),document.body.webkitRequestFullScreen&&k.addEventListener("webkitfullscreenchange",function(){document.webkitIsFullScreen||N(k)},!1),g=n.iframe.getElementById("epiceditor-utilbar"),g.style.display="none",g.addEventListener("mouseover",function(){y&&clearTimeout(y)}),O=[n.previewerIframeDocument,n.editorIframeDocument];for(M=0;M<O.length;M++)O[M].addEventListener("mousemove",function(e){P(e)}),O[M].addEventListener("scroll",function(e){P(e)}),O[M].addEventListener("keyup",function(e){B(e)}),O[M].addEventListener("keydown",function(e){H(e)});return n.settings.file.autoSave&&(n.saveInterval=e.setInterval(function(){if(!n._canSave)return;n.save()},n.settings.file.autoSave)),e.addEventListener("resize",function(){!n.iframe.webkitRequestFullScreen&&n.eeState.fullscreen?(r(n.iframeElement,{width:e.outerWidth+"px",height:e.innerHeight+"px"}),r(n.element,{height:e.innerHeight+"px"}),r(n.previewerIframe,{width:e.outerWidth/2+"px",height:e.innerHeight+"px"}),r(n.editorIframe,{width:e.outerWidth/2+"px",height:e.innerHeight+"px"})):n.eeState.fullscreen||D(C)}),n.iframe.close(),n.eeState.loaded=!0,n.eeState.unloaded=!1,t.call(this),this.emit("load"),this},m.prototype.unload=function(t){if(this.eeState.unloaded)throw new Error("Editor isn't loaded");var n=this,r=e.parent.document.getElementById(n._instanceId);return r.parentNode.removeChild(r),n.eeState.loaded=!1,n.eeState.unloaded=!0,t=t||function(){},n.saveInterval&&e.clearInterval(n.saveInterval),t.call(this),n.emit("unload"),n},m.prototype.preview=function(e){var t=this;return e=e||t.settings.basePath+t.settings.theme.preview,f(t.getElement("wrapper"),"epiceditor-edit-mode","epiceditor-preview-mode"),t.previewerIframeDocument.getElementById("theme")?t.previewerIframeDocument.getElementById("theme").name!==e&&(t.previewerIframeDocument.getElementById("theme").href=e):a(e,t.previewerIframeDocument,"theme"),t.previewer.innerHTML=t.exportFile(null,"html"),t.eeState.fullscreen||(t.editorIframe.style.display="none",t.previewerIframe.style.display="block",t.eeState.preview=!0,t.eeState.edit=!1,t.previewerIframe.focus()),t.emit("preview"),t},m.prototype.edit=function(){var e=this;return f(e.getElement("wrapper"),"epiceditor-preview-mode","epiceditor-edit-mode"),e.eeState.preview=!1,e.eeState.edit=!0,e.editorIframe.style.display="block",e.previewerIframe.style.display="none",e.editorIframe.focus(),e.emit("edit"),this},m.prototype.getElement=function(e){var t={container:this.element,wrapper:this.iframe.getElementById("epiceditor-wrapper"),wrapperIframe:this.iframeElement,editor:this.editorIframeDocument,editorIframe:this.editorIframe,previewer:this.previewerIframeDocument,previewerIframe:this.previewerIframe};return!t[e]||this.eeState.unloaded?null:t[e]},m.prototype.open=function(e){var n=this,r=n.settings.file.defaultContent,i;return e=e||n.settings.file.name,n.settings.file.name=e,this._storage[n.settings.localStorageName]&&(i=n.getFiles(),i[e]!==t?(h(n.editor,i[e].content),n.emit("read")):(h(n.editor,r),n.save(),n.emit("create")),n.previewer.innerHTML=n.exportFile(null,"html"),n.emit("open")),this},m.prototype.save=function(){var e=this,n,r=!1,i=e.settings.file.name,s=c(this.editor);return this._canSave=!0,n=JSON.parse(this._storage[e.settings.localStorageName]),n[i]===t?n[i]=e._defaultFileSchema():s!==n[i].content&&(n[i].modified=new Date,r=!0),n[i].content=s,this._storage[e.settings.localStorageName]=JSON.stringify(n),r&&e.emit("update"),this.emit("save"),this},m.prototype.remove=function(e){var t=this,n;return e=e||t.settings.file.name,e==t.settings.file.name&&(t._canSave=!1),n=JSON.parse(this._storage[t.settings.localStorageName]),delete n[e],this._storage[t.settings.localStorageName]=JSON.stringify(n),this.emit("remove"),this},m.prototype.rename=function(e,t){var n=this,r=JSON.parse(this._storage[n.settings.localStorageName]);return r[t]=r[e],delete r[e],this._storage[n.settings.localStorageName]=JSON.stringify(r),n.open(t),this},m.prototype.importFile=function(e,n,r,i){var s=this,o=!1;return e=e||s.settings.file.name,n=n||"",r=r||"md",i=i||{},JSON.parse(this._storage[s.settings.localStorageName])[e]===t&&(o=!0),s.settings.file.name=e,h(s.editor,n),o&&s.emit("create"),s.save(),s.eeState.fullscreen&&s.preview(),this},m.prototype.exportFile=function(e,n){var r=this,i,s;e=e||r.settings.file.name,n=n||"text",i=r.getFiles(e);if(i===t)return;s=i.content;switch(n){case"html":return s=s.replace(/\u00a0/g," ").replace(/&nbsp;/g," "),r.settings.parser(s);case"text":return s=s.replace(/&nbsp;/g," "),s;default:return s}},m.prototype.getFiles=function(e){var t=JSON.parse(this._storage[this.settings.localStorageName]);return e?t[e]:t},m.prototype.on=function(e,t){var n=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),n},m.prototype.emit=function(e,t){function i(e){e.call(n,t)}var n=this,r;t=t||n.getFiles(n.settings.file.name);if(!this.events[e])return;for(r=0;r<n.events[e].length;r++)i(n.events[e][r]);return n},m.prototype.removeListener=function(e,t){var n=this;return t?this.events[e]?(this.events[e].splice(this.events[e].indexOf(t),1),n):n:(this.events[e]=[],n)},m.version="0.1.1",m._data={},e.EpicEditor=m}(window),function(){function n(e,n){return e[0][0]!=="!"?'<a href="'+f(n.href)+'"'+(n.title?' title="'+f(n.title)+'"':"")+">"+t.lexer(e[1])+"</a>":'<img src="'+f(n.href)+'" alt="'+f(e[1])+'"'+(n.title?' title="'+f(n.title)+'"':"")+">"}function s(){return i=r.pop()}function o(){switch(i.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+i.depth+">"+t.lexer(i.text)+"</h"+i.depth+">\n";case"code":return v.highlight&&(i.code=v.highlight(i.text,i.lang),i.code!=null&&i.code!==i.text&&(i.escaped=!0,i.text=i.code)),i.escaped||(i.text=f(i.text,!0)),"<pre><code"+(i.lang?' class="lang-'+i.lang+'"':"")+">"+i.text+"</code></pre>\n";case"blockquote_start":var e="";while(s().type!=="blockquote_end")e+=o();return"<blockquote>\n"+e+"</blockquote>\n";case"list_start":var n=i.ordered?"ol":"ul",e="";while(s().type!=="list_end")e+=o();return"<"+n+">\n"+e+"</"+n+">\n";case"list_item_start":var e="";while(s().type!=="list_item_end")e+=i.type==="text"?u():o();return"<li>"+e+"</li>\n";case"loose_item_start":var e="";while(s().type!=="list_item_end")e+=o();return"<li>"+e+"</li>\n";case"html":return v.sanitize?t.lexer(i.text):!i.pre&&!v.pedantic?t.lexer(i.text):i.text;case"paragraph":return"<p>"+t.lexer(i.text)+"</p>\n";case"text":return"<p>"+u()+"</p>\n"}}function u(){var e=i.text,n;while((n=r[r.length-1])&&n.type==="text")e+="\n"+s().text;return t.lexer(e)}function a(e){r=e.reverse();var t="";while(s())t+=o();return r=null,i=null,t}function f(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function l(e){var t="",n=e.length,r=0,i;for(;r<n;r++)i=e.charCodeAt(r),Math.random()>.5&&(i="x"+i.toString(16)),t+="&#"+i+";";return t}function c(){var e="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+";return e}function h(e,t){return e=e.source,t=t||"",function n(r,i){return r?(e=e.replace(r,i.source||i),n):new RegExp(e,t)}}function p(){}function d(t,n){return g(n),a(e.lexer(t))}function g(n){n||(n=m);if(v===n)return;v=n,v.gfm?(e.fences=e.gfm.fences,e.paragraph=e.gfm.paragraph,t.text=t.gfm.text,t.url=t.gfm.url):(e.fences=e.normal.fences,e.paragraph=e.normal.paragraph,t.text=t.normal.text,t.url=t.normal.url),v.pedantic?(t.em=t.pedantic.em,t.strong=t.pedantic.strong):(t.em=t.normal.em,t.strong=t.normal.strong)}var e={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:p,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [^\0]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *([^\s]+)(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,paragraph:/^([^\n]+\n?(?!body))+\n*/,text:/^[^\n]+/};e.bullet=/(?:[*+-]|\d+\.)/,e.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,e.item=h(e.item,"gm")(/bull/g,e.bullet)(),e.list=h(e.list)(/bull/g,e.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),e.html=h(e.html)("comment",/<!--[^\0]*?-->/)("closed",/<(tag)[^\0]+?<\/\1>/)("closing",/<tag(?!:\/|@)\b(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,c())(),e.paragraph=function(){var t=e.paragraph.source,n=[];return function r(t){return t=e[t]?e[t].source:t,n.push(t.replace(/(^|[^\[])\^/g,"$1")),r}("hr")("heading")("lheading")("blockquote")("<"+c())("def"),new RegExp(t.replace("body",n.join("|")))}(),e.normal={fences:e.fences,paragraph:e.paragraph},e.gfm={fences:/^ *``` *(\w+)? *\n([^\0]+?)\s*``` *(?:\n+|$)/,paragraph:/^/},e.gfm.paragraph=h(e.paragraph)("(?!","(?!"+e.gfm.fences.source.replace(/(^|[^\[])\^/g,"$1")+"|")(),e.lexer=function(t){var n=[];return n.links={},t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),e.token(t,n,!0)},e.token=function(t,n,r){var t=t.replace(/^ +$/gm,""),i,s,o,u,a,f,l;while(t){if(o=e.newline.exec(t))t=t.substring(o[0].length),o[0].length>1&&n.push({type:"space"});if(o=e.code.exec(t)){t=t.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),n.push({type:"code",text:v.pedantic?o:o.replace(/\n+$/,"")});continue}if(o=e.fences.exec(t)){t=t.substring(o[0].length),n.push({type:"code",lang:o[1],text:o[2]});continue}if(o=e.heading.exec(t)){t=t.substring(o[0].length),n.push({type:"heading",depth:o[1].length,text:o[2]});continue}if(o=e.lheading.exec(t)){t=t.substring(o[0].length),n.push({type:"heading",depth:o[2]==="="?1:2,text:o[1]});continue}if(o=e.hr.exec(t)){t=t.substring(o[0].length),n.push({type:"hr"});continue}if(o=e.blockquote.exec(t)){t=t.substring(o[0].length),n.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),e.token(o,n,r),n.push({type:"blockquote_end"});continue}if(o=e.list.exec(t)){t=t.substring(o[0].length),n.push({type:"list_start",ordered:isFinite(o[2])}),o=o[0].match(e.item),i=!1,l=o.length,f=0;for(;f<l;f++)u=o[f],a=u.length,u=u.replace(/^ *([*+-]|\d+\.) +/,""),~u.indexOf("\n ")&&(a-=u.length,u=v.pedantic?u.replace(/^ {1,4}/gm,""):u.replace(new RegExp("^ {1,"+a+"}","gm"),"")),s=i||/\n\n(?!\s*$)/.test(u),f!==l-1&&(i=u[u.length-1]==="\n",s||(s=i)),n.push({type:s?"loose_item_start":"list_item_start"}),e.token(u,n),n.push({type:"list_item_end"});n.push({type:"list_end"});continue}if(o=e.html.exec(t)){t=t.substring(o[0].length),n.push({type:"html",pre:o[1]==="pre",text:o[0]});continue}if(r&&(o=e.def.exec(t))){t=t.substring(o[0].length),n.links[o[1].toLowerCase()]={href:o[2],title:o[3]};continue}if(r&&(o=e.paragraph.exec(t))){t=t.substring(o[0].length),n.push({type:"paragraph",text:o[0]});continue}if(o=e.text.exec(t)){t=t.substring(o[0].length),n.push({type:"text",text:o[0]});continue}}return n};var t={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:p,tag:/^<!--[^\0]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([^\0]+?)__(?!_)|^\*\*([^\0]+?)\*\*(?!\*)/,em:/^\b_((?:__|[^\0])+?)_\b|^\*((?:\*\*|[^\0])+?)\*(?!\*)/,code:/^(`+)([^\0]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,text:/^[^\0]+?(?=[\\<!\[_*`]| {2,}\n|$)/};t._linkInside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,t._linkHref=/\s*<?([^\s]*?)>?(?:\s+['"]([^\0]*?)['"])?\s*/,t.link=h(t.link)("inside",t._linkInside)("href",t._linkHref)(),t.reflink=h(t.reflink)("inside",t._linkInside)(),t.normal={url:t.url,strong:t.strong,em:t.em,text:t.text},t.pedantic={strong:/^__(?=\S)([^\0]*?\S)__(?!_)|^\*\*(?=\S)([^\0]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([^\0]*?\S)_(?!_)|^\*(?=\S)([^\0]*?\S)\*(?!\*)/},t.gfm={url:/^(https?:\/\/[^\s]+[^.,:;"')\]\s])/,text:/^[^\0]+?(?=[\\<!\[_*`]|https?:\/\/| {2,}\n|$)/},t.lexer=function(e){var i="",s=r.links,o,u,a,c;while(e){if(c=t.escape.exec(e)){e=e.substring(c[0].length),i+=c[1];continue}if(c=t.autolink.exec(e)){e=e.substring(c[0].length),c[2]==="@"?(u=c[1][6]===":"?l(c[1].substring(7)):l(c[1]),a=l("mailto:")+u):(u=f(c[1]),a=u),i+='<a href="'+a+'">'+u+"</a>";continue}if(c=t.url.exec(e)){e=e.substring(c[0].length),u=f(c[1]),a=u,i+='<a href="'+a+'">'+u+"</a>";continue}if(c=t.tag.exec(e)){e=e.substring(c[0].length),i+=v.sanitize?f(c[0]):c[0];continue}if(c=t.link.exec(e)){e=e.substring(c[0].length),i+=n(c,{href:c[2],title:c[3]});continue}if((c=t.reflink.exec(e))||(c=t.nolink.exec(e))){e=e.substring(c[0].length),o=(c[2]||c[1]).replace(/\s+/g," "),o=s[o.toLowerCase()];if(!o||!o.href){i+=c[0][0],e=c[0].substring(1)+e;continue}i+=n(c,o);continue}if(c=t.strong.exec(e)){e=e.substring(c[0].length),i+="<strong>"+t.lexer(c[2]||c[1])+"</strong>";continue}if(c=t.em.exec(e)){e=e.substring(c[0].length),i+="<em>"+t.lexer(c[2]||c[1])+"</em>";continue}if(c=t.code.exec(e)){e=e.substring(c[0].length),i+="<code>"+f(c[2],!0)+"</code>";continue}if(c=t.br.exec(e)){e=e.substring(c[0].length),i+="<br>";continue}if(c=t.text.exec(e)){e=e.substring(c[0].length),i+=f(c[0]);continue}}return i};var r,i;p.exec=p;var v,m;d.options=d.setOptions=function(e){return m=e,g(e),d},d.setOptions({gfm:!0,pedantic:!1,sanitize:!1,highlight:null}),d.parser=function(e,t){return g(t),a(e)},d.lexer=function(t,n){return g(n),e.lexer(t)},d.parse=d,typeof module!="undefined"?module.exports=d:this.marked=d}.call(function(){return this||(typeof window!="undefined"?window:global)}()),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};window.HtmlEditor=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events={"click a[href=#edit]":"showEditor","ajax:success [role=editor] form":"showDisplay"},n.prototype.initialize=function(){return CodeMirror.fromTextArea(this.$("[role=editor] .content")[0],{mode:"text/html",tabMode:"indent"}),this.$("[role=editor]").hide().css("visibility","visible")},n.prototype.showDisplay=function(e,t){return e.preventDefault(),this.$("[role=editor]").hide(),this.$("[role=display]").show(),this.$("[role=display] .content").html(t.formatted_content)},n.prototype.showEditor=function(e){return e.preventDefault(),this.$("[role=editor]").show(),this.$("[role=display]").hide()},n}(Backbone.View),jQuery(function(e){var t,n,r,i;i=e("[role=html-editor]");for(n=0,r=i.length;n<r;n++)t=i[n],new HtmlEditor({el:t});return e("body.cms form textarea").each(function(){var t,n,r;return t=e('<div class="epiceditor-container">'),n=e(this).hide().after(t),r=new EpicEditor({container:t[0],basePath:"/assets/epiceditor",clientSideStorage:!1,file:{defaultContent:n.val()}}),r.load(),r.on("update",function(e){return n.val(e.content)})})})}.call(this);